<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê°€ì…ì ëª©ë¡ ê´€ë¦¬</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="admin.css">
</head>
<body>
  <!-- ê¶Œí•œ ì²´í¬ ë¡œë”© í™”ë©´ -->
  <div id="authCheckLoading">
    <div>
      <div class="loading-spinner"></div>
      <h3>ê¶Œí•œ í™•ì¸ ì¤‘...</h3>
      <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
    </div>
  </div>
  
  <!-- ë©”ì¸ ì½˜í…ì¸  (ê¶Œí•œ í™•ì¸ í›„ í‘œì‹œ) -->
  <div id="mainContent">
    <div class="site-brand-fixed"><a href="index.html">ì‡í”Œ</a></div>
    
    <!-- ê´€ë¦¬ì ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ -->
    <div class="admin-nav-container">
      <div class="admin-container">
        <nav class="admin-nav">
          <button class="nav-btn" data-section="dashboard">
            ëŒ€ì‹œë³´ë“œ
          </button>
          <button class="nav-btn" data-section="users">
            ê°€ì…ì ê´€ë¦¬
          </button>
          <button class="nav-btn" data-section="products">
            ìƒí’ˆ ê´€ë¦¬
          </button>
          <button class="nav-btn" data-section="nutrition">
            ì˜ì–‘ ì •ë³´ ê´€ë¦¬
          </button>
          <button class="nav-btn" data-section="contacts">
            ë¬¸ì˜ ê´€ë¦¬
          </button>
          <button class="nav-btn" data-section="promotions">
            í˜ì´ì§€ ê´€ë¦¬
          </button>
        </nav>
      </div>
    </div>
    
    <div class="admin-container">
    
    <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
    <div id="dashboardSection" class="admin-section">
      <h2>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>
      <div class="admin-stats-section">
        <h3>ì„œë¹„ìŠ¤ ì´ìš© í†µê³„</h3>
        <div class="stats-overview">
          <div class="stat-card">
            <div class="stat-title">ì´ ì‚¬ìš©ì</div>
            <div class="stat-number" id="totalUsers">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">ì¶”ì²œì‹ë‹¨</div>
            <div class="stat-number" id="totalMealPlan">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">ì¶”ì²œì‹ë‹¹</div>
            <div class="stat-number" id="totalRestaurant">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">ì¶”ì²œì˜ì–‘ì œ</div>
            <div class="stat-number" id="totalSupplement">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">ì‹ì¬ë£Œë¶„ì„</div>
            <div class="stat-number" id="totalIngredient">0</div>
          </div>
        </div>
      </div>

      <!-- ìƒí’ˆ ê´€ë¦¬ í†µê³„ -->
      <div class="admin-stats-section">
        <h3>ìƒí’ˆ ê´€ë¦¬ í†µê³„</h3>
        <div class="stats-overview">
          <div class="stat-card">
            <div class="stat-title">ì´ ìƒí’ˆ</div>
            <div class="stat-number" id="totalProducts">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">í™œì„± ìƒí’ˆ</div>
            <div class="stat-number" id="activeProducts">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">ë¹„í™œì„± ìƒí’ˆ</div>
            <div class="stat-number" id="inactiveProducts">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">ìƒí’ˆ ì¹´í…Œê³ ë¦¬</div>
            <div class="stat-number" id="totalCategories">0</div>
          </div>
          <div class="stat-card clickable-stat" id="todayViewsCard" onclick="showTodayViewsDetail()">
            <div class="stat-title">ì˜¤ëŠ˜ ì¡°íšŒìˆ˜</div>
            <div class="stat-number" id="todayViews">0</div>
            <div class="stat-subtitle">í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸°</div>
          </div>
        </div>
      </div>

      
    </div>

    <!-- ì˜¤ëŠ˜ ì¡°íšŒìˆ˜ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="todayViewsModal">
      <div class="modal-content views-modal">
        <div class="modal-header">
          <h3>ì˜¤ëŠ˜ ì¡°íšŒìˆ˜ ìƒì„¸</h3>
          <button class="modal-close" id="closeTodayViewsModal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="views-summary">
            <div class="summary-item">
              <span class="summary-label">ì´ ì¡°íšŒìˆ˜:</span>
              <span class="summary-value" id="totalTodayViews">0</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">ì¡°íšŒëœ ìƒí’ˆ:</span>
              <span class="summary-value" id="viewedProductsCount">0</span>
            </div>
          </div>
          
          <div class="views-filters">
            <select id="viewsSortBy">
              <option value="views_desc">ì¡°íšŒìˆ˜ ë†’ì€ìˆœ</option>
              <option value="views_asc">ì¡°íšŒìˆ˜ ë‚®ì€ìˆœ</option>
              <option value="name_asc">ìƒí’ˆëª… ìˆœ</option>
            </select>
            <input type="text" id="viewsSearchInput" placeholder="ìƒí’ˆëª… ê²€ìƒ‰...">
          </div>

          <div class="views-list" id="todayViewsList">
            <div class="loading-placeholder">
              <div class="spinner"></div>
              <p>ì¡°íšŒìˆ˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ê°€ì…ì ê´€ë¦¬ ì„¹ì…˜ -->
    <div id="usersSection" class="admin-section hidden">
      <h2>ê°€ì…ì ëª©ë¡</h2>
      <div id="userCount"></div>
      <table id="usersTable" class="admin-table">
        <thead>
          <tr><th>ID</th><th>ì•„ì´ë””/ì´ë©”ì¼</th><th>ì¸ì¦ë°©ì‹</th><th>ê°€ì…ì¼</th><th>ì‚­ì œ</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="adminMsg"></div>
    </div>

    <!-- ìƒí’ˆ ê´€ë¦¬ ì„¹ì…˜ -->
    <div id="productsSection" class="admin-section hidden">
      <h2>ìƒí’ˆ ê´€ë¦¬</h2>
      <div class="products-header">
        <div class="products-header-left">
          <span class="products-header-title">ìƒí’ˆ ê´€ë¦¬ ì‹œìŠ¤í…œ</span>
        </div>
        <div class="products-header-right">
          <button class="admin-action-btn green" onclick="openProductManagement()">
            ìƒí’ˆ ê´€ë¦¬ í˜ì´ì§€ ì—´ê¸°
          </button>
          <button class="admin-action-btn gray" onclick="refreshProductStats()">
            í†µê³„ ìƒˆë¡œê³ ì¹¨
          </button>
        </div>
      </div>
      
      <!-- ìƒí’ˆ ê´€ë¦¬ ì„ë² ë“œ í”„ë ˆì„ -->
      <div class="products-frame-container">
        <iframe id="productManagementFrame" 
                src="admin-product-management.html" 
                onload="handleProductFrameLoad()">
        </iframe>
      </div>
    </div>



    <!-- ì˜ì–‘ ì •ë³´ ê´€ë¦¬ ì„¹ì…˜ -->
    <div id="nutritionSection" class="admin-section hidden">
      <h2>ì˜ì–‘ ì •ë³´ ê´€ë¦¬</h2>
      
      <!-- ì˜ì–‘ ì •ë³´ ì½˜í…ì¸  ê´€ë¦¬ -->
      <div class="admin-stats-section">
        <h3>ì˜ì–‘ ì •ë³´ ì½˜í…ì¸  ê´€ë¦¬</h3>
      
      <!-- ê²€ìƒ‰ ë° í•„í„° -->
      <div class="nutrition-filters">
        <input type="text" id="searchNutritionInfo" class="nutrition-search-input" placeholder="ì œëª© ë˜ëŠ” ë‚´ìš© ê²€ìƒ‰...">
        <select id="filterCategory" class="nutrition-filter-select">
          <option value="">ëª¨ë“  ì¹´í…Œê³ ë¦¬</option>
          <option value="diet">ì‹ë‹¨</option>
          <option value="supplements">ë³´ì¶©ì œ</option>
          <option value="research">ì—°êµ¬</option>
          <option value="trends">íŠ¸ë Œë“œ</option>
        </select>
        <select id="filterSourceType" class="nutrition-filter-select">
          <option value="">ëª¨ë“  ì†ŒìŠ¤</option>
          <option value="paper">ë…¼ë¬¸</option>
          <option value="youtube">ìœ íŠœë¸Œ</option>
          <option value="news">ë‰´ìŠ¤</option>
        </select>
        <select id="filterStatus" class="nutrition-filter-select">
          <option value="">ëª¨ë“  ìƒíƒœ</option>
          <option value="active">í™œì„±</option>
          <option value="inactive">ë¹„í™œì„±</option>
          <option value="pending">ëŒ€ê¸°</option>
        </select>
        <button id="searchBtn" class="admin-action-btn">ê²€ìƒ‰</button>
      </div>

      <!-- ì¼ê´„ ì²˜ë¦¬ ë„êµ¬ -->
      <div class="bulk-actions-container">
        <h4 class="bulk-actions-title">ì¼ê´„ ì²˜ë¦¬</h4>
        <div class="bulk-actions-controls">
          <span class="bulk-actions-label">ì„ íƒëœ í•­ëª©:</span>
          <span id="selectedCount" class="bulk-selected-count">0ê°œ</span>
          <select id="bulkAction" class="bulk-action-select">
            <option value="">ì‘ì—… ì„ íƒ</option>
            <option value="activate">í™œì„±í™”</option>
            <option value="deactivate">ë¹„í™œì„±í™”</option>
            <option value="delete">ì‚­ì œ</option>
          </select>
          <button id="executeBulkAction" class="admin-action-btn" disabled>ì‹¤í–‰</button>
          <button id="selectAll" class="admin-action-btn gray">ì „ì²´ ì„ íƒ</button>
          <button id="deselectAll" class="admin-action-btn gray">ì„ íƒ í•´ì œ</button>
        </div>
      </div>

      <!-- ì˜ì–‘ ì •ë³´ ëª©ë¡ -->
      <div class="nutrition-table-container">
        <div class="nutrition-table-scroll">
          <table id="nutritionInfoTable" class="nutrition-table">
            <thead>
              <tr>
                <th class="checkbox-col">
                  <input type="checkbox" id="selectAllCheckbox">
                </th>
                <th>ì œëª©</th>
                <th class="source-col">ì†ŒìŠ¤</th>
                <th class="category-col">ì¹´í…Œê³ ë¦¬</th>
                <th class="reliability-col">ì‹ ë¢°ë„</th>
                <th class="status-col">ìƒíƒœ</th>
                <th class="actions-col">ì‘ì—…</th>
              </tr>
            </thead>
            <tbody id="nutritionInfoTableBody">
              <tr>
                <td colspan="7">ë¡œë”© ì¤‘...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
      <div id="pagination" class="admin-pagination">
        <!-- í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </div>
    </div>

      <!-- ìˆ˜ë™ í¬ìŠ¤íŒ… ê´€ë¦¬ -->
      <div class="admin-stats-section">
        <h3>ì˜ì–‘ ì •ë³´ ìˆ˜ë™ í¬ìŠ¤íŒ…</h3>
      
      <!-- í¬ìŠ¤íŒ… ì‘ì„± í¼ -->
      <div id="postingFormSection" class="posting-form-container">
        <div class="posting-form-header">
          <h4 class="posting-form-title">ìƒˆ í¬ìŠ¤íŒ… ì‘ì„±</h4>
          <div class="posting-form-actions">
            <button id="newPostBtn" class="admin-action-btn">ìƒˆ í¬ìŠ¤íŒ…</button>
            <button id="managePostsBtn" class="admin-action-btn gray">í¬ìŠ¤íŒ… ê´€ë¦¬</button>
          </div>
        </div>
        
        <form id="nutritionPostingForm" class="posting-form">
          <div class="form-container">
            <!-- ì™¼ìª½: ë©”ì¸ ì…ë ¥ í¼ -->
            <div class="posting-form-main">
              <div class="form-group">
                <label for="postTitle">ì œëª© *</label>
                <input type="text" id="postTitle" name="title" required 
                       placeholder="ì˜ì–‘ ì •ë³´ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
              </div>
              
              <div class="form-group">
                <label for="postSummary">ìš”ì•½ *</label>
                <textarea id="postSummary" name="summary" required rows="3"
                          placeholder="ì˜ì–‘ ì •ë³´ì˜ ê°„ë‹¨í•œ ìš”ì•½ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
              </div>
              
              <div class="form-group">
                <label for="postContent">ë‚´ìš© *</label>
                <div class="editor-toolbar">
                  <button type="button" class="editor-btn" data-command="bold">
                    <strong>B</strong>
                  </button>
                  <button type="button" class="editor-btn" data-command="italic">
                    <em>I</em>
                  </button>
                  <button type="button" class="editor-btn" data-command="underline" title="ë°‘ì¤„">U</button>
                  <button type="button" class="editor-btn" data-command="strikeThrough" title="ì·¨ì†Œì„ ">S</button>
                  <button type="button" class="editor-btn" data-command="insertUnorderedList">
                    â€¢ ëª©ë¡
                  </button>
                  <button type="button" class="editor-btn" data-command="insertOrderedList">
                    1. ëª©ë¡
                  </button>
                  <button type="button" class="editor-btn" id="textAlignLeftBtn" title="í…ìŠ¤íŠ¸ ì™¼ìª½ ì •ë ¬">â¬…ï¸</button>
                  <button type="button" class="editor-btn" id="textAlignCenterBtn" title="í…ìŠ¤íŠ¸ ê°€ìš´ë° ì •ë ¬">â†”ï¸</button>
                  <button type="button" class="editor-btn" id="textAlignRightBtn" title="í…ìŠ¤íŠ¸ ì˜¤ë¥¸ìª½ ì •ë ¬">â¡ï¸</button>
                  <button type="button" class="editor-btn" id="createLinkBtn" title="ë§í¬ ì¶”ê°€">ğŸ”—</button>
                  <button type="button" class="editor-btn" id="removeLinkBtn" title="ë§í¬ ì œê±°">âŒğŸ”—</button>
                  <button type="button" class="editor-btn" id="insertImageBtn">
                    ğŸ–¼ï¸ ì´ë¯¸ì§€
                  </button>
                  <button type="button" class="editor-btn" id="insertTableBtn">
                    ğŸ“Š í‘œ
                  </button>
                  <button type="button" class="editor-btn" data-command="insertHorizontalRule" title="êµ¬ë¶„ì„ ">â”</button>
                  <button type="button" class="editor-btn" data-command="removeFormat" title="ì„œì‹ ì œê±°">ğŸ§¹</button>
                  <button type="button" class="editor-btn" data-command="undo" title="ì‹¤í–‰ ì·¨ì†Œ">â†¶</button>
                  <button type="button" class="editor-btn" data-command="redo" title="ë‹¤ì‹œ ì‹¤í–‰">â†·</button>
                  <!-- ì´ë¯¸ì§€ ì •ë ¬ -->
                  <button type="button" class="editor-btn" id="imgAlignLeftBtn" title="ì´ë¯¸ì§€ ì™¼ìª½ ì •ë ¬">ğŸ¡ ğŸ–¼ï¸</button>
                  <button type="button" class="editor-btn" id="imgAlignCenterBtn" title="ì´ë¯¸ì§€ ê°€ìš´ë° ì •ë ¬">ğŸ–¼ï¸</button>
                  <button type="button" class="editor-btn" id="imgAlignRightBtn" title="ì´ë¯¸ì§€ ì˜¤ë¥¸ìª½ ì •ë ¬">ğŸ–¼ï¸ğŸ¡¢</button>
                  <button type="button" class="editor-btn" id="imgAlignNoneBtn" title="ì´ë¯¸ì§€ ì •ë ¬ í•´ì œ">â›”ğŸ–¼ï¸</button>
                </div>
                <div class="editor-container">
                  <div id="postContent" class="editor-content" contenteditable="true" placeholder="ìƒì„¸í•œ ì˜ì–‘ ì •ë³´ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...">
                  </div>
                </div>
              </div>
              
              <div class="form-grid-2">
                <div class="form-group">
                  <label for="postCategory">ì¹´í…Œê³ ë¦¬ *</label>
                  <select id="postCategory" name="category" required>
                    <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                    <option value="diet">ì‹ë‹¨</option>
                    <option value="supplements">ë³´ì¶©ì œ</option>
                    <option value="research">ì—°êµ¬</option>
                    <option value="trends">íŠ¸ë Œë“œ</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="newCategory">ìƒˆ ì¹´í…Œê³ ë¦¬</label>
                  <input type="text" id="newCategory" name="newCategory" 
                         placeholder="ìƒˆ ì¹´í…Œê³ ë¦¬ ì…ë ¥">
                </div>
              </div>
              
              <div class="form-group">
                <label for="postTags">íƒœê·¸</label>
                <input type="text" id="postTags" name="tags" 
                       placeholder="íƒœê·¸ë¥¼ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥ (ì˜ˆ: ë¹„íƒ€ë¯¼D, ë©´ì—­ë ¥, ê²¨ìš¸ì² ì˜ì–‘)">
                <div id="tagSuggestions" class="tag-suggestions">
                  <div class="tag-suggestions-container">
                    <div class="tag-suggestions-label">ì¶”ì²œ íƒœê·¸:</div>
                    <div id="suggestedTags" class="suggested-tags"></div>
                  </div>
                </div>
              </div>

              <!-- ê´€ë ¨ ìƒí’ˆ ì •ë³´ -->
              <div class="form-group">
                <label>ê´€ë ¨ ìƒí’ˆ ì •ë³´</label>
                <div class="related-products-help">
                  <p class="help-text">ğŸ’¡ <strong>iframe ë§í¬ ì…ë ¥ ë°©ë²•:</strong></p>
                  <p class="help-text">ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” iframe ì½”ë“œì˜ src ì†ì„± ê°’ì„ ì…ë ¥í•˜ì„¸ìš”.</p>
                  <p class="help-text">ì˜ˆì‹œ: <code>https://coupa.ng/cjIiFf</code></p>
                  <p class="help-text">ì „ì²´ iframe ì½”ë“œ: <code>&lt;iframe src="https://coupa.ng/cjIiFf" width="120" height="240" frameborder="0" scrolling="no" referrerpolicy="unsafe-url" browsingtopics&gt;&lt;/iframe&gt;</code></p>
                </div>
                <div class="related-products-container">
                  <div class="related-product-item" id="product1">
                    <h4>ìƒí’ˆ 1</h4>
                    <div class="form-grid-2">
                      <div class="form-group">
                        <label for="productName1">ìƒí’ˆëª…</label>
                        <input type="text" id="productName1" name="productName1" 
                               placeholder="ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                      </div>
                      <div class="form-group">
                        <label for="productLink1">iframe ë§í¬ (src ê°’)</label>
                        <input type="url" id="productLink1" name="productLink1" 
                               placeholder="https://coupa.ng/cjIiFf"
                               class="iframe-link-input">
                        <div class="iframe-link-help">
                          <small>ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ iframeì˜ src ì†ì„± ê°’ë§Œ ì…ë ¥í•˜ì„¸ìš”</small>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="related-product-item" id="product2">
                    <h4>ìƒí’ˆ 2</h4>
                    <div class="form-grid-2">
                      <div class="form-group">
                        <label for="productName2">ìƒí’ˆëª…</label>
                        <input type="text" id="productName2" name="productName2" 
                               placeholder="ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                      </div>
                      <div class="form-group">
                        <label for="productLink2">iframe ë§í¬ (src ê°’)</label>
                        <input type="url" id="productLink2" name="productLink2" 
                               placeholder="https://coupa.ng/cjIiFf"
                               class="iframe-link-input">
                        <div class="iframe-link-help">
                          <small>ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ iframeì˜ src ì†ì„± ê°’ë§Œ ì…ë ¥í•˜ì„¸ìš”</small>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="related-product-item" id="product3">
                    <h4>ìƒí’ˆ 3</h4>
                    <div class="form-grid-2">
                      <div class="form-group">
                        <label for="productName3">ìƒí’ˆëª…</label>
                        <input type="text" id="productName3" name="productName3" 
                               placeholder="ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                      </div>
                      <div class="form-group">
                        <label for="productLink3">iframe ë§í¬ (src ê°’)</label>
                        <input type="url" id="productLink3" name="productLink3" 
                               placeholder="https://coupa.ng/cjIiFf"
                               class="iframe-link-input">
                        <div class="iframe-link-help">
                          <small>ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ iframeì˜ src ì†ì„± ê°’ë§Œ ì…ë ¥í•˜ì„¸ìš”</small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <label for="sourceUrl">ì›ë³¸ ì†ŒìŠ¤ URL</label>
                <div class="url-validation-container">
                  <input type="url" id="sourceUrl" name="sourceUrl" 
                         placeholder="https://example.com/source">
                  <button type="button" id="validateUrlBtn" class="admin-action-btn">URL ê²€ì¦</button>
                </div>
                <div id="urlValidationResult" class="url-validation-result"></div>
              </div>
              
              <div class="form-group">
                <label for="nutritionThumbnail">ì¸ë„¤ì¼ ì´ë¯¸ì§€</label>
                <div class="thumbnail-upload-container">
                  <div class="thumbnail-upload-area" id="thumbnailUploadArea">
                    <div class="thumbnail-upload-content">
                      <div class="thumbnail-upload-icon">ğŸ“·</div>
                      <div class="thumbnail-upload-text">
                        <p>ì¸ë„¤ì¼ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                        <p class="thumbnail-upload-hint">JPG, PNG, GIF, WebP (ìµœëŒ€ 5MB)</p>
                      </div>
                      <input type="file" id="nutritionThumbnail" name="nutritionThumbnail" 
                             accept="image/jpeg,image/png,image/gif,image/webp" 
                             style="display: none;">
                      <button type="button" class="admin-action-btn" id="selectThumbnailBtn">íŒŒì¼ ì„ íƒ</button>
                    </div>
                  </div>
                  <div class="thumbnail-preview" id="thumbnailPreview" style="display: none;">
                    <div class="thumbnail-preview-image">
                      <img id="thumbnailPreviewImg" src="" alt="ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸°">
                      <button type="button" class="thumbnail-remove-btn" id="removeThumbnailBtn">&times;</button>
                    </div>
                    <div class="thumbnail-info">
                      <div class="thumbnail-filename" id="thumbnailFilename"></div>
                      <div class="thumbnail-filesize" id="thumbnailFilesize"></div>
                    </div>
                  </div>
                  <div class="thumbnail-url-input" style="margin-top: 10px;">
                    <input type="url" id="thumbnailUrl" name="thumbnailUrl" 
                           placeholder="ë˜ëŠ” ì´ë¯¸ì§€ URLì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”" 
                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                  </div>
                </div>
              </div>
            </div>

          </div>
          
          <!-- í¼ ì•¡ì…˜ ë²„íŠ¼ -->
          <div class="form-footer">
            <button type="button" id="saveDraftBtn" class="admin-action-btn gray">ì„ì‹œì €ì¥</button>
            <button type="submit" id="publishBtn" class="admin-action-btn">ê²Œì‹œ</button>
          </div>
        </form>
      </div>
      
      <!-- í¬ìŠ¤íŒ… ê´€ë¦¬ ì„¹ì…˜ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€) -->
      <div id="postManagementSection" class="post-management-section">
        <div class="post-management-header">
          <h4 class="post-management-title">í¬ìŠ¤íŒ… ê´€ë¦¬</h4>
          <button id="backToFormBtn" class="admin-action-btn gray">ì‘ì„± í¼ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
        
        <!-- í¬ìŠ¤íŒ… í•„í„° -->
        <div class="post-management-filters">
          <input type="text" id="searchPosts" class="post-search-input-full" placeholder="í¬ìŠ¤íŒ… ê²€ìƒ‰...">
          <select id="filterPostStatus" class="post-filter-select-full">
            <option value="">ëª¨ë“  ìƒíƒœ</option>
            <option value="published">ê²Œì‹œë¨</option>
            <option value="draft">ì„ì‹œì €ì¥</option>
            <option value="inactive">ë¹„í™œì„±</option>
          </select>
          <select id="filterPostCategory" class="post-filter-select-full">
            <option value="">ëª¨ë“  ì¹´í…Œê³ ë¦¬</option>
            <option value="diet">ì‹ë‹¨</option>
            <option value="supplements">ë³´ì¶©ì œ</option>
            <option value="research">ì—°êµ¬</option>
            <option value="trends">íŠ¸ë Œë“œ</option>
          </select>
          <button id="searchPostsBtn" class="admin-action-btn">ê²€ìƒ‰</button>
        </div>
        
        <!-- í¬ìŠ¤íŒ… ëª©ë¡ í…Œì´ë¸” -->
        <div class="posts-table-container-full">
          <div class="posts-table-scroll-full">
            <table id="postsManagementTable" class="posts-table-full">
              <thead>
                <tr>
                  <th>ì œëª©</th>
                  <th class="category-col-full">ì¹´í…Œê³ ë¦¬</th>
                  <th class="status-col-full">ìƒíƒœ</th>
                  <th class="date-col-full">ì‘ì„±ì¼</th>
                  <th class="views-col-full">ì¡°íšŒìˆ˜</th>
                  <th class="manage-col-full">ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="postsManagementTableBody">
                <tr>
                  <td colspan="6">í¬ìŠ¤íŒ…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- í¬ìŠ¤íŒ… í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div id="postsPagination" class="posts-pagination-full">
          <!-- í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
      </div>
    </div>
    </div> <!-- nutritionSection ë -->

    <!-- ë¬¸ì˜ ê´€ë¦¬ ì„¹ì…˜ -->
    <div id="contactsSection" class="admin-section hidden">
      <h2>ë¬¸ì˜ ê´€ë¦¬</h2>
      
      <div class="admin-stats-section">
        <h3>ë¬¸ì˜ ê´€ë¦¬</h3>
      
      <div class="contact-filters">
        <div class="filter-group">
          <label for="statusFilter">ìƒíƒœ:</label>
          <select id="statusFilter">
            <option value="all">ì „ì²´</option>
            <option value="pending">ëŒ€ê¸°ì¤‘</option>
            <option value="in-progress">ì²˜ë¦¬ì¤‘</option>
            <option value="resolved">í•´ê²°ë¨</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="categoryFilter">ìœ í˜•:</label>
          <select id="categoryFilter">
            <option value="all">ì „ì²´</option>
            <option value="service">ì„œë¹„ìŠ¤ ì´ìš© ë¬¸ì˜</option>
            <option value="account">ê³„ì • ê´€ë ¨ ë¬¸ì˜</option>
            <option value="payment">ê²°ì œ ê´€ë ¨ ë¬¸ì˜</option>
            <option value="suggestion">ê¸°ëŠ¥ ì œì•ˆ</option>
            <option value="bug">ì˜¤ë¥˜ ì‹ ê³ </option>
            <option value="other">ê¸°íƒ€ ë¬¸ì˜</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="dateFilter">ê¸°ê°„:</label>
          <select id="dateFilter">
            <option value="all">ì „ì²´</option>
            <option value="today">ì˜¤ëŠ˜</option>
            <option value="week">ìµœê·¼ 7ì¼</option>
            <option value="month">ìµœê·¼ 30ì¼</option>
          </select>
        </div>
      </div>
      
      <table class="contact-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>ì œëª©</th>
            <th>ìœ í˜•</th>
            <th>ì‚¬ìš©ì</th>
            <th>ì ‘ìˆ˜ì¼</th>
            <th>ìƒíƒœ</th>
            <th>ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody id="contactTableBody">
          <!-- ë¬¸ì˜ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
          <tr>
            <td colspan="7" class="no-contacts">ë¬¸ì˜ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td>
          </tr>
        </tbody>
      </table>
      
      <div class="pagination" id="contactPagination">
        <!-- í˜ì´ì§€ë„¤ì´ì…˜ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
      </div>
    </div>
  </div>

    <!-- í”„ë¡œëª¨ì…˜ ê´€ë¦¬ ì„¹ì…˜ -->
    <div id="promotionsSection" class="admin-section hidden">
      <h2>í˜ì´ì§€ ê´€ë¦¬ - í”„ë¡œëª¨ì…˜ ì¹´ë“œ</h2>
      
      <div class="admin-controls">
        <button class="btn-primary" onclick="openPromotionForm()">
          ìƒˆ í”„ë¡œëª¨ì…˜ ì¶”ê°€
        </button>
        <div class="search-container">
          <input type="text" id="promotionSearch" placeholder="í”„ë¡œëª¨ì…˜ ê²€ìƒ‰..." onkeyup="filterPromotions()">
        </div>
      </div>

      <div class="promotions-grid" id="promotionsGrid">
        <!-- í”„ë¡œëª¨ì…˜ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
      </div>
    </div>

    <!-- í”„ë¡œëª¨ì…˜ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="promotionModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="promotionModalTitle">ìƒˆ í”„ë¡œëª¨ì…˜ ì¶”ê°€</h3>
          <button class="modal-close" onclick="closePromotionModal()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="promotionForm">
            <div class="form-group">
              <label for="promotionTitle">ì œëª© *</label>
              <input type="text" id="promotionTitle" required>
            </div>
            
            <div class="form-group">
              <label for="promotionSubtitle">ë¶€ì œëª©</label>
              <input type="text" id="promotionSubtitle">
            </div>
            
            <div class="form-group">
              <label for="promotionDescription">ì„¤ëª…</label>
              <textarea id="promotionDescription" rows="3"></textarea>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="promotionBadge">ë°°ì§€ (í• ì¸ìœ¨ ë“±)</label>
                <input type="text" id="promotionBadge" placeholder="ì˜ˆ: 15%">
              </div>
              
              <div class="form-group">
                <label for="promotionTag">íƒœê·¸</label>
                <input type="text" id="promotionTag" placeholder="ì˜ˆ: íŠ¹ê°€ ì´ë²¤íŠ¸">
              </div>
            </div>
            
            <div class="form-group">
              <label for="promotionTheme">í…Œë§ˆ *</label>
              <select id="promotionTheme" required>
                <option value="">í…Œë§ˆ ì„ íƒ</option>
                <option value="water-theme">ë¬¼ í…Œë§ˆ</option>
                <option value="bottle-theme">ë³‘ í…Œë§ˆ</option>
                <option value="travel-theme">ì—¬í–‰ í…Œë§ˆ</option>
                <option value="food-theme">ìŒì‹ í…Œë§ˆ</option>
                <option value="beauty-theme">ë·°í‹° í…Œë§ˆ</option>
                <option value="fitness-theme">í”¼íŠ¸ë‹ˆìŠ¤ í…Œë§ˆ</option>
                <option value="vitamin-theme">ë¹„íƒ€ë¯¼ í…Œë§ˆ</option>
                <option value="supplement-theme">ì˜ì–‘ì œ í…Œë§ˆ</option>
                <option value="default-theme">ê¸°ë³¸ í…Œë§ˆ</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="promotionImageUrl">ì´ë¯¸ì§€ URL</label>
              <input type="url" id="promotionImageUrl" placeholder="https://example.com/image.jpg">
            </div>
            
            <div class="form-group">
              <label for="promotionIcons">ì•„ì´ì½˜ (ì´ëª¨ì§€ 4ê°œ, ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
              <input type="text" id="promotionIcons" placeholder="ğŸ¥¤,ğŸ“¦,ğŸ ,â­">
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="promotionDisplayOrder">í‘œì‹œ ìˆœì„œ</label>
                <input type="number" id="promotionDisplayOrder" min="0" value="0">
              </div>
              
              <div class="form-group">
                <label for="promotionIsActive">í™œì„±í™”</label>
                <select id="promotionIsActive">
                  <option value="true">í™œì„±</option>
                  <option value="false">ë¹„í™œì„±</option>
                </select>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="promotionStartDate">ì‹œì‘ ë‚ ì§œ</label>
                <input type="datetime-local" id="promotionStartDate">
              </div>
              
              <div class="form-group">
                <label for="promotionEndDate">ì¢…ë£Œ ë‚ ì§œ</label>
                <input type="datetime-local" id="promotionEndDate">
              </div>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn-primary">ì €ì¥</button>
              <button type="button" class="btn-secondary" onclick="closePromotionModal()">ì·¨ì†Œ</button>
            </div>
          </form>
        </div>
      </div>
    </div>

  <!-- ë¬¸ì˜ ìƒì„¸ ëª¨ë‹¬ -->
  <div id="contactDetailModal" class="contact-detail-modal">
    <div class="contact-detail-content">
      <div class="contact-detail-header">
        <h2>ë¬¸ì˜ ìƒì„¸ ì •ë³´</h2>
        <span class="close-modal" id="closeDetailModal">&times;</span>
      </div>
      <div class="contact-detail-body">
        <div class="contact-detail-info">
          <h3 id="contactSubject">ë¬¸ì˜ ì œëª©</h3>
          <div class="info-row">
            <div class="info-label">ë¬¸ì˜ ìœ í˜•</div>
            <div class="info-value" id="contactCategory">ì„œë¹„ìŠ¤ ì´ìš© ë¬¸ì˜</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì‚¬ìš©ì</div>
            <div class="info-value" id="contactUsername">ì‚¬ìš©ìëª…</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì´ë©”ì¼</div>
            <div class="info-value" id="contactEmail">user@example.com</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì ‘ìˆ˜ì¼</div>
            <div class="info-value" id="contactDate">2025-07-23 14:30</div>
          </div>
        </div>
        
        <h3>ë¬¸ì˜ ë‚´ìš©</h3>
        <div class="contact-message" id="contactMessage">
          ë¬¸ì˜ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
        </div>
        
        <div class="admin-response">
          <h3>ê´€ë¦¬ì ì‘ë‹µ</h3>
          <select id="contactStatus" class="status-select">
            <option value="pending">ëŒ€ê¸°ì¤‘</option>
            <option value="in-progress">ì²˜ë¦¬ì¤‘</option>
            <option value="resolved">í•´ê²°ë¨</option>
          </select>
          <textarea id="adminComment" placeholder="ê´€ë¦¬ì ì‘ë‹µì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        </div>
      </div>
      <div class="contact-detail-footer">
        <button id="cancelBtn" class="cancel-btn">ì·¨ì†Œ</button>
        <button id="saveBtn" class="save-btn">ì €ì¥</button>
      </div>
    </div>
  </div>

  <script src="admin.js"></script>
  <script>
    // ë¬¸ì˜ ê´€ë¦¬ ê´€ë ¨ ì „ì—­ ë³€ìˆ˜ëŠ” admin.jsì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¬¸ì˜ ëª©ë¡ ë¡œë“œ
    document.addEventListener('DOMContentLoaded', function() {
      // ë„¤ë¹„ê²Œì´ì…˜ ì´ˆê¸°í™”
      setupNavigationEventListeners();
      
      // ê¸°ì¡´ admin.js ì´ˆê¸°í™” ì´í›„ì— ë¬¸ì˜ ê´€ë¦¬ ê¸°ëŠ¥ ì´ˆê¸°í™”
      setTimeout(() => {
        // í•„í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        if (document.getElementById('statusFilter')) {
          document.getElementById('statusFilter').addEventListener('change', applyFilters);
        }
        if (document.getElementById('categoryFilter')) {
          document.getElementById('categoryFilter').addEventListener('change', applyFilters);
        }
        if (document.getElementById('dateFilter')) {
          document.getElementById('dateFilter').addEventListener('change', applyFilters);
        }
        
        // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
        if (document.getElementById('closeDetailModal')) {
          document.getElementById('closeDetailModal').addEventListener('click', closeContactDetailModal);
        }
        if (document.getElementById('cancelBtn')) {
          document.getElementById('cancelBtn').addEventListener('click', closeContactDetailModal);
        }
        
        // ì €ì¥ ë²„íŠ¼
        if (document.getElementById('saveBtn')) {
          document.getElementById('saveBtn').addEventListener('click', saveContactUpdate);
        }
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.addEventListener('click', function(e) {
          if (e.target === document.getElementById('contactDetailModal')) {
            closeContactDetailModal();
          }
        });
      }, 500);
    });
    
    // ë¬¸ì˜ í…Œì´ë¸” ë Œë”ë§
    function renderContactTable(filteredContacts) {
      const tableBody = document.getElementById('contactTableBody');
      if (!tableBody) return;
      
      // ì‹œì‘ ë° ì¢…ë£Œ ì¸ë±ìŠ¤ ê³„ì‚°
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = Math.min(startIndex + itemsPerPage, filteredContacts.length);
      
      // í…Œì´ë¸” ë‚´ìš© ì´ˆê¸°í™”
      tableBody.innerHTML = '';
      
      // ë¬¸ì˜ê°€ ì—†ëŠ” ê²½ìš°
      if (filteredContacts.length === 0) {
        showNoContacts('ì¡°ê±´ì— ë§ëŠ” ë¬¸ì˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // í˜„ì¬ í˜ì´ì§€ì˜ ë¬¸ì˜ ëª©ë¡ ë Œë”ë§
      for (let i = startIndex; i < endIndex; i++) {
        const contact = filteredContacts[i];
        const row = document.createElement('tr');
        
        // ë¬¸ì˜ ID (ì§§ê²Œ í‘œì‹œ)
        const shortId = contact.id.split('_')[1]?.substring(0, 8) || contact.id.substring(0, 8);
        
        // ì¹´í…Œê³ ë¦¬ í•œê¸€ ë³€í™˜
        const categoryMap = {
          'service': 'ì„œë¹„ìŠ¤ ì´ìš©',
          'account': 'ê³„ì • ê´€ë ¨',
          'payment': 'ê²°ì œ ê´€ë ¨',
          'suggestion': 'ê¸°ëŠ¥ ì œì•ˆ',
          'bug': 'ì˜¤ë¥˜ ì‹ ê³ ',
          'other': 'ê¸°íƒ€ ë¬¸ì˜'
        };
        
        // ìƒíƒœ í•œê¸€ ë³€í™˜
        const statusMap = {
          'pending': 'ëŒ€ê¸°ì¤‘',
          'in-progress': 'ì²˜ë¦¬ì¤‘',
          'resolved': 'í•´ê²°ë¨'
        };
        
        // ë‚ ì§œ í¬ë§·
        const date = new Date(contact.createdAt);
        const formattedDate = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        
        row.innerHTML = `
          <td>${shortId}</td>
          <td>${contact.subject}</td>
          <td>${categoryMap[contact.category] || contact.category}</td>
          <td>${contact.username}</td>
          <td>${formattedDate}</td>
          <td><span class="status-badge status-${contact.status}">${statusMap[contact.status] || contact.status}</span></td>
          <td><button class="action-btn view-btn" data-id="${contact.id}">ë³´ê¸°</button></td>
        `;
        
        tableBody.appendChild(row);
      }
      
      // ìƒì„¸ ë³´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const contactId = this.getAttribute('data-id');
          openContactDetail(contactId);
        });
      });
    }
    
    // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
    function renderPagination(totalItems) {
      const pagination = document.getElementById('contactPagination');
      if (!pagination) return;
      
      pagination.innerHTML = '';
      
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      
      // í˜ì´ì§€ê°€ 1í˜ì´ì§€ë§Œ ìˆëŠ” ê²½ìš° í˜ì´ì§€ë„¤ì´ì…˜ í‘œì‹œ ì•ˆí•¨
      if (totalPages <= 1) {
        return;
      }
      
      // ì´ì „ í˜ì´ì§€ ë²„íŠ¼
      if (currentPage > 1) {
        const prevBtn = document.createElement('button');
        prevBtn.className = 'pagination-btn';
        prevBtn.textContent = 'ì´ì „';
        prevBtn.addEventListener('click', () => {
          currentPage--;
          applyFilters();
        });
        pagination.appendChild(prevBtn);
      }
      
      // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼
      const maxPageButtons = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxPageButtons / 2));
      let endPage = Math.min(totalPages, startPage + maxPageButtons - 1);
      
      if (endPage - startPage + 1 < maxPageButtons) {
        startPage = Math.max(1, endPage - maxPageButtons + 1);
      }
      
      for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = 'pagination-btn';
        if (i === currentPage) {
          pageBtn.classList.add('active');
        }
        pageBtn.textContent = i;
        pageBtn.addEventListener('click', () => {
          currentPage = i;
          applyFilters();
        });
        pagination.appendChild(pageBtn);
      }
      
      // ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼
      if (currentPage < totalPages) {
        const nextBtn = document.createElement('button');
        nextBtn.className = 'pagination-btn';
        nextBtn.textContent = 'ë‹¤ìŒ';
        nextBtn.addEventListener('click', () => {
          currentPage++;
          applyFilters();
        });
        pagination.appendChild(nextBtn);
      }
    }
    
    // ë¬¸ì˜ ì—†ìŒ ë©”ì‹œì§€ í‘œì‹œ
    function showNoContacts(message) {
      const tableBody = document.getElementById('contactTableBody');
      if (!tableBody) return;
      
      tableBody.innerHTML = `<tr><td colspan="7" class="no-contacts">${message}</td></tr>`;
    }
    
    // ë¬¸ì˜ ìƒì„¸ ì •ë³´ ì—´ê¸°
    async function openContactDetail(contactId) {
      try {
        const response = await fetch(`/api/contact/admin/detail/${contactId}`, {
          credentials: 'include'
        });
        
        const data = await response.json();
        
        if (data.success) {
          const contact = data.data;
          currentContactId = contact.id;
          
          // ì¹´í…Œê³ ë¦¬ í•œê¸€ ë³€í™˜
          const categoryMap = {
            'service': 'ì„œë¹„ìŠ¤ ì´ìš© ë¬¸ì˜',
            'account': 'ê³„ì • ê´€ë ¨ ë¬¸ì˜',
            'payment': 'ê²°ì œ ê´€ë ¨ ë¬¸ì˜',
            'suggestion': 'ê¸°ëŠ¥ ì œì•ˆ',
            'bug': 'ì˜¤ë¥˜ ì‹ ê³ ',
            'other': 'ê¸°íƒ€ ë¬¸ì˜'
          };
          
          // ëª¨ë‹¬ ë‚´ìš© ì±„ìš°ê¸°
          document.getElementById('contactSubject').textContent = contact.subject;
          document.getElementById('contactCategory').textContent = categoryMap[contact.category] || contact.category;
          document.getElementById('contactUsername').textContent = contact.username;
          document.getElementById('contactEmail').textContent = contact.email;
          
          // ë‚ ì§œ í¬ë§·
          const date = new Date(contact.createdAt);
          const formattedDate = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
          document.getElementById('contactDate').textContent = formattedDate;
          
          document.getElementById('contactMessage').textContent = contact.message;
          document.getElementById('contactStatus').value = contact.status;
          document.getElementById('adminComment').value = contact.adminComment || '';
          
          // ëª¨ë‹¬ í‘œì‹œ
          document.getElementById('contactDetailModal').style.display = 'block';
          document.body.style.overflow = 'hidden'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
        } else {
          alert('ë¬¸ì˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ë¬¸ì˜ ìƒì„¸ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
        alert('ë¬¸ì˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // ë¬¸ì˜ ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
    function closeContactDetailModal() {
      const modal = document.getElementById('contactDetailModal');
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = ''; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë³µì›
        currentContactId = null;
      }
    }
    
    // ë¬¸ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì €ì¥
    async function saveContactUpdate() {
      if (!currentContactId) return;
      
      const status = document.getElementById('contactStatus').value;
      const adminComment = document.getElementById('adminComment').value;
      
      try {
        const response = await fetch(`/api/contact/admin/update/${currentContactId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ status, adminComment }),
          credentials: 'include'
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('ë¬¸ì˜ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
          closeContactDetailModal();
          loadContacts(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        } else {
          alert('ë¬¸ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ë¬¸ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
        alert('ë¬¸ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // ë„¤ë¹„ê²Œì´ì…˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    function setupNavigationEventListeners() {
      // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ì´ë²¤íŠ¸ëŠ” admin.jsì˜ setupNavigation()ì—ì„œ ì²˜ë¦¬ë¨
      
      // í”„ë ˆì„ ê°„ í†µì‹  ì²˜ë¦¬
      window.addEventListener('message', function(event) {
        // ë³´ì•ˆì„ ìœ„í•´ origin ì²´í¬ (ê°™ì€ ë„ë©”ì¸ë§Œ í—ˆìš©)
        if (event.origin !== window.location.origin) {
          return;
        }
        
        if (event.data && event.data.type === 'productStatsUpdate') {
          // ìƒí’ˆ í†µê³„ ì—…ë°ì´íŠ¸ ìš”ì²­
          if (typeof refreshProductStats === 'function') {
            refreshProductStats();
          }
        } else if (event.data && event.data.type === 'navigateToSection') {
          // ì„¹ì…˜ ë„¤ë¹„ê²Œì´ì…˜ ìš”ì²­
          if (typeof navigateToSection === 'function') {
            navigateToSection(event.data.section);
          }
        }
      });
    }
    </script>
    </div> <!-- contactsSection ë -->
    
    </div> <!-- admin-container ë -->
  </div> <!-- mainContent ë -->
  
  <!-- ì´ë¯¸ì§€ ì‚½ì… ëª¨ë‹¬ -->
  <div id="imageInsertModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3>ì´ë¯¸ì§€ ì‚½ì…</h3>
        <button class="modal-close" id="imageInsertClose">&times;</button>
      </div>
      <div class="modal-body">
        <div style="margin-bottom: 15px;">
          <label for="imageUrl" style="display: block; margin-bottom: 5px; font-weight: 500;">ì´ë¯¸ì§€ URL</label>
          <input type="url" id="imageUrl" placeholder="https://example.com/image.jpg" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div style="margin-bottom: 15px;">
          <label for="imageAlt" style="display: block; margin-bottom: 5px; font-weight: 500;">ëŒ€ì²´ í…ìŠ¤íŠ¸</label>
          <input type="text" id="imageAlt" placeholder="ì´ë¯¸ì§€ ì„¤ëª…" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 500;">ë˜ëŠ” íŒŒì¼ ì—…ë¡œë“œ</label>
          <input type="file" id="descriptionImageInput" accept="image/*" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
      </div>
      <div style="padding: 15px 25px; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 10px;">
        <button type="button" class="admin-action-btn" id="imageInsertCancel" style="background: #6c757d;">ì·¨ì†Œ</button>
        <button type="button" class="admin-action-btn" id="imageInsertConfirm">ì‚½ì…</button>
      </div>
    </div>
  </div>

  <!-- í‘œ ì‚½ì… ëª¨ë‹¬ -->
  <div id="tableInsertModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-header">
        <h3>í‘œ ì‚½ì…</h3>
        <button class="modal-close" id="tableInsertClose">&times;</button>
      </div>
      <div class="modal-body">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
          <div>
            <label for="tableRows" style="display: block; margin-bottom: 5px; font-weight: 500;">í–‰ ìˆ˜</label>
            <input type="number" id="tableRows" value="3" min="1" max="10" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
          </div>
          <div>
            <label for="tableCols" style="display: block; margin-bottom: 5px; font-weight: 500;">ì—´ ìˆ˜</label>
            <input type="number" id="tableCols" value="2" min="1" max="6" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
          </div>
        </div>
        <div style="margin-bottom: 15px;">
          <label style="display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" id="tableHeader" checked>
            <span>ì²« ë²ˆì§¸ í–‰ì„ í—¤ë”ë¡œ ì‚¬ìš©</span>
          </label>
        </div>
      </div>
      <div style="padding: 15px 25px; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 10px;">
        <button type="button" class="admin-action-btn" id="tableInsertCancel" style="background: #6c757d;">ì·¨ì†Œ</button>
        <button type="button" class="admin-action-btn" id="tableInsertConfirm">ì‚½ì…</button>
      </div>
    </div>
  </div>

  <style>
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>

  <script>
    // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™” (admin.jsì—ì„œ ê´€ë¦¬ë¨)

    // ì˜ì–‘ì •ë³´ í¬ìŠ¤íŒ… ì—ë””í„° ê´€ë ¨ JavaScript
    class NutritionPostEditor {
      constructor() {
        this.editor = null;
        this.savedEditorRange = null;
        this.lastClickedImage = null;
        this.isSubmitting = false; // ì¤‘ë³µ ì œì¶œ ë°©ì§€
        this.init();
      }

      init() {
        this.setupEditor();
        this.bindEditorEvents();
      }



      setupEditor() {
        this.editor = document.getElementById("postContent");
        if (!this.editor) return;

        // ì—ë””í„° í¬ì»¤ìŠ¤/ë¸”ëŸ¬ ì´ë²¤íŠ¸
        this.editor.addEventListener("focus", () => {
          // í”Œë ˆì´ìŠ¤í™€ë” ì²˜ë¦¬ëŠ” CSSë¡œ ëŒ€ì²´
        });

        this.editor.addEventListener("blur", () => {
          // í”Œë ˆì´ìŠ¤í™€ë” ì²˜ë¦¬ëŠ” CSSë¡œ ëŒ€ì²´
        });

        // selection ì €ì¥
        const save = () => this.saveEditorSelection();
        this.editor.addEventListener("keyup", save);
        this.editor.addEventListener("mouseup", save);
        this.editor.addEventListener("input", save);
        this.editor.addEventListener("focus", save);
        


        // ì´ë¯¸ì§€ í´ë¦­ ì‹œ ëŒ€ìƒ ì´ë¯¸ì§€ ê¸°ì–µ
        this.editor.addEventListener("click", (e) => {
          const img = e.target && (e.target.tagName === "IMG" ? e.target : e.target.closest && e.target.closest("img"));
          if (img) {
            this.lastClickedImage = img;
            this.saveEditorSelection();
          }
        });
      }

      bindEditorEvents() {
        // íˆ´ë°” ë²„íŠ¼ ì´ë²¤íŠ¸
        document.querySelectorAll('.editor-btn[data-command]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.preventDefault();
            const command = btn.getAttribute('data-command');
            this.executeCommand(command);
          });
        });

        // í…ìŠ¤íŠ¸ ì •ë ¬ ë²„íŠ¼
        document.getElementById('textAlignLeftBtn')?.addEventListener('click', (e) => {
          e.preventDefault();
          this.executeCommand('justifyLeft');
        });

        document.getElementById('textAlignCenterBtn')?.addEventListener('click', (e) => {
          e.preventDefault();
          this.executeCommand('justifyCenter');
        });

        document.getElementById('textAlignRightBtn')?.addEventListener('click', (e) => {
          e.preventDefault();
          this.executeCommand('justifyRight');
        });

        // ë§í¬ ê´€ë ¨ ë²„íŠ¼
        document.getElementById('createLinkBtn')?.addEventListener('click', (e) => {
          e.preventDefault();
          this.createLink();
        });

        document.getElementById('removeLinkBtn')?.addEventListener('click', (e) => {
          e.preventDefault();
          this.executeCommand('unlink');
        });

        // ì´ë¯¸ì§€ ì‚½ì… ë²„íŠ¼
        document.getElementById('insertImageBtn')?.addEventListener('click', (e) => {
          e.preventDefault();
          this.showImageInsertModal();
        });

        // í‘œ ì‚½ì… ë²„íŠ¼
        document.getElementById('insertTableBtn')?.addEventListener('click', (e) => {
          e.preventDefault();
          this.showTableInsertModal();
        });

        // ì´ë¯¸ì§€ ì •ë ¬ ë²„íŠ¼ë“¤
        document.getElementById('imgAlignLeftBtn')?.addEventListener('click', (e) => {
          e.preventDefault();
          this.applyImageAlignment('left');
        });

        document.getElementById('imgAlignCenterBtn')?.addEventListener('click', (e) => {
          e.preventDefault();
          this.applyImageAlignment('center');
        });

        document.getElementById('imgAlignRightBtn')?.addEventListener('click', (e) => {
          e.preventDefault();
          this.applyImageAlignment('right');
        });

        document.getElementById('imgAlignNoneBtn')?.addEventListener('click', (e) => {
          e.preventDefault();
          this.applyImageAlignment('none');
        });

        // ì´ë¯¸ì§€ ì‚½ì… ëª¨ë‹¬ ì´ë²¤íŠ¸
        this.bindImageModalEvents();
        // í‘œ ì‚½ì… ëª¨ë‹¬ ì´ë²¤íŠ¸
        this.bindTableModalEvents();
        
        // í¼ ì œì¶œ ì´ë²¤íŠ¸
        this.bindFormEvents();
      }

      saveEditorSelection() {
        try {
          const selection = window.getSelection();
          if (!selection || selection.rangeCount === 0) return;
          const range = selection.getRangeAt(0);
          if (this.editor && this.editor.contains(range.startContainer) && this.editor.contains(range.endContainer)) {
            this.savedEditorRange = range.cloneRange();
          }
        } catch (_) {}
      }

      restoreEditorSelection() {
        if (!this.editor) return;
        this.editor.focus();
        const selection = window.getSelection();
        if (!selection) return;
        selection.removeAllRanges();
        const range = this.savedEditorRange;
        if (range && this.editor.contains(range.startContainer) && this.editor.contains(range.endContainer)) {
          selection.addRange(range);
        } else {
          const caret = document.createRange();
          caret.selectNodeContents(this.editor);
          caret.collapse(false);
          selection.addRange(caret);
        }
      }

      executeCommand(command, value = null) {
        this.restoreEditorSelection();
        document.execCommand(command, false, value);
        this.saveEditorSelection();
      }

      createLink() {
        const url = prompt('ë§í¬ URLì„ ì…ë ¥í•˜ì„¸ìš”:');
        if (url) {
          this.executeCommand('createLink', url);
        }
      }

      insertHtmlIntoEditor(html) {
        this.restoreEditorSelection();
        const before = this.editor.innerHTML;
        let succeeded = false;
        try {
          succeeded = document.execCommand("insertHTML", false, html);
        } catch (_) {
          succeeded = false;
        }
        
        if (!succeeded || this.editor.innerHTML === before) {
          const selection = window.getSelection();
          if (selection && selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            const fragmentContainer = document.createElement("div");
            fragmentContainer.innerHTML = html;
            const node = fragmentContainer.firstChild;
            if (node) {
              range.insertNode(node);
              range.setStartAfter(node);
              range.collapse(true);
              selection.removeAllRanges();
              selection.addRange(range);
            } else {
              this.editor.insertAdjacentHTML("beforeend", html);
            }
          } else {
            this.editor.insertAdjacentHTML("beforeend", html);
          }
        }
        
        setTimeout(() => {
          this.editor.focus();
          this.saveEditorSelection();
        }, 10);
      }

      showImageInsertModal() {
        document.getElementById('imageInsertModal').classList.add('active');
      }

      showTableInsertModal() {
        document.getElementById('tableInsertModal').classList.add('active');
      }

      bindImageModalEvents() {
        const modal = document.getElementById('imageInsertModal');
        const closeBtn = document.getElementById('imageInsertClose');
        const cancelBtn = document.getElementById('imageInsertCancel');
        const confirmBtn = document.getElementById('imageInsertConfirm');

        closeBtn?.addEventListener('click', () => {
          modal.classList.remove('active');
        });

        cancelBtn?.addEventListener('click', () => {
          modal.classList.remove('active');
        });

        confirmBtn?.addEventListener('click', () => {
          this.insertImage();
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        modal?.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.classList.remove('active');
          }
        });
      }

      bindFormEvents() {
        const form = document.getElementById('nutritionPostingForm');
        const publishBtn = document.getElementById('publishBtn');
        const saveDraftBtn = document.getElementById('saveDraftBtn');
        
        // í¼ ì œì¶œ ì´ë²¤íŠ¸
        form?.addEventListener('submit', (e) => {
          e.preventDefault();
          this.handleFormSubmit('publish');
        });
        
        // ê²Œì‹œ ë²„íŠ¼
        publishBtn?.addEventListener('click', (e) => {
          e.preventDefault();
          this.handleFormSubmit('publish');
        });
        
        // ì„ì‹œì €ì¥ ë²„íŠ¼
        saveDraftBtn?.addEventListener('click', (e) => {
          e.preventDefault();
          this.handleFormSubmit('draft');
        });
      }
      
      async handleFormSubmit(status = 'publish') {
        // ì¤‘ë³µ ì œì¶œ ë°©ì§€
        if (this.isSubmitting) {
          console.log('ì´ë¯¸ ì œì¶œ ì¤‘ì…ë‹ˆë‹¤. ì¤‘ë³µ ìš”ì²­ì„ ë¬´ì‹œí•©ë‹ˆë‹¤.');
          return;
        }
        
        this.isSubmitting = true;
        
        // ë²„íŠ¼ ë¹„í™œì„±í™”
        const publishBtn = document.getElementById('publishBtn');
        const saveDraftBtn = document.getElementById('saveDraftBtn');
        if (publishBtn) publishBtn.disabled = true;
        if (saveDraftBtn) saveDraftBtn.disabled = true;
        
        try {
          const formData = this.collectFormData();
          formData.isDraft = (status === 'draft');
          
          // ì¸ë„¤ì¼ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
          if (formData.thumbnailFile) {
            console.log('ì¸ë„¤ì¼ íŒŒì¼ ì—…ë¡œë“œ ì¤‘...');
            const thumbnailFormData = new FormData();
            thumbnailFormData.append('thumbnail', formData.thumbnailFile);
            
            const thumbnailResponse = await fetch('/api/admin/manual-posting/upload-thumbnail', {
              method: 'POST',
              credentials: 'include',
              body: thumbnailFormData
            });
            
            if (!thumbnailResponse.ok) {
              throw new Error(`ì¸ë„¤ì¼ ì—…ë¡œë“œ ì‹¤íŒ¨: ${thumbnailResponse.status} ${thumbnailResponse.statusText}`);
            }
            
            const thumbnailResult = await thumbnailResponse.json();
            
            if (thumbnailResult.success) {
              formData.thumbnailUrl = thumbnailResult.data.url;
              console.log('ì¸ë„¤ì¼ ì—…ë¡œë“œ ì™„ë£Œ:', formData.thumbnailUrl);
            } else {
              throw new Error('ì¸ë„¤ì¼ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + thumbnailResult.error);
            }
          }
          
          // thumbnailFileì€ ì„œë²„ë¡œ ë³´ë‚´ì§€ ì•ŠìŒ
          delete formData.thumbnailFile;
          
          console.log('í¬ìŠ¤íŒ… ë°ì´í„°:', formData); // ë””ë²„ê¹…ìš©
          
          // í¸ì§‘ ëª¨ë“œì¸ì§€ í™•ì¸ - currentEditingPostIdëŠ” ì „ì—­ ë³€ìˆ˜
          const isEditMode = typeof currentEditingPostId !== 'undefined' && 
                            currentEditingPostId !== null && 
                            currentEditingPostId !== undefined && 
                            currentEditingPostId !== '';
          
          const url = isEditMode 
            ? `/api/admin/manual-posting/posts/${currentEditingPostId}`
            : '/api/admin/manual-posting/posts';
          const method = isEditMode ? 'PUT' : 'POST';
          
          console.log('ìš”ì²­ ëª¨ë“œ:', isEditMode ? 'í¸ì§‘' : 'ìƒˆ í¬ìŠ¤íŒ…', 'URL:', url, 'Method:', method);
          console.log('currentEditingPostId:', currentEditingPostId);
          
          const response = await fetch(url, {
            method: method,
            headers: {
              'Content-Type': 'application/json'
            },
            credentials: 'include',
            body: JSON.stringify(formData)
          });
          
          const result = await response.json();
          
          if (result.success) {
            const action = isEditMode ? 'ìˆ˜ì •' : 'ì‘ì„±';
            alert(status === 'publish' ? `í¬ìŠ¤íŒ…ì´ ${action}ë˜ì–´ ê²Œì‹œë˜ì—ˆìŠµë‹ˆë‹¤!` : `í¬ìŠ¤íŒ…ì´ ${action}ë˜ì–´ ì„ì‹œì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            this.resetForm();
            
            // í¸ì§‘ ì™„ë£Œ í›„ í¬ìŠ¤íŒ… ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™
            if (isEditMode) {
              setTimeout(() => {
                if (typeof showPostManagement === 'function') {
                  showPostManagement();
                  // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                  if (typeof loadPostsList === 'function') {
                    loadPostsList();
                  }
                }
              }, 1000);
            }
          } else {
            throw new Error(result.error || 'í¬ìŠ¤íŒ… ì‹¤íŒ¨');
          }
        } catch (error) {
          console.error('í¬ìŠ¤íŒ… ì˜¤ë¥˜:', error);
          alert('í¬ìŠ¤íŒ… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        } finally {
          // ì œì¶œ ì™„ë£Œ í›„ í”Œë˜ê·¸ ë¦¬ì…‹ ë° ë²„íŠ¼ í™œì„±í™”
          this.isSubmitting = false;
          const publishBtn = document.getElementById('publishBtn');
          const saveDraftBtn = document.getElementById('saveDraftBtn');
          if (publishBtn) publishBtn.disabled = false;
          if (saveDraftBtn) saveDraftBtn.disabled = false;
        }
      }
      
      collectFormData() {
        // ì¸ë„¤ì¼ ë°ì´í„° ìˆ˜ì§‘
        const thumbnailFile = document.getElementById('nutritionThumbnail')?.files[0];
        const thumbnailUrl = document.getElementById('thumbnailUrl')?.value?.trim();
        
        return {
          title: document.getElementById('postTitle')?.value || '',
          summary: document.getElementById('postSummary')?.value || '',
          content: this.editor?.innerHTML || '',
          category: document.getElementById('postCategory')?.value || document.getElementById('newCategory')?.value || '',
          tags: document.getElementById('postTags')?.value || '',
          sourceUrl: document.getElementById('sourceUrl')?.value || '',
          thumbnailUrl: thumbnailUrl || null,
          thumbnailFile: thumbnailFile || null,
          sourceType: 'manual',
          // ê´€ë ¨ ìƒí’ˆ ì…ë ¥ê°’ ì „ë‹¬ (ë°±ì—”ë“œ ë¼ìš°íŠ¸ì—ì„œ ê¸°ëŒ€í•˜ëŠ” í•„ë“œëª…ê³¼ ì¼ì¹˜)
          productName1: document.getElementById('productName1')?.value || '',
          productLink1: document.getElementById('productLink1')?.value || '',
          productName2: document.getElementById('productName2')?.value || '',
          productLink2: document.getElementById('productLink2')?.value || '',
          productName3: document.getElementById('productName3')?.value || '',
          productLink3: document.getElementById('productLink3')?.value || ''
        };
      }
      
      resetForm() {
        // í¼ ë¦¬ì…‹
        document.getElementById('nutritionPostingForm')?.reset();
        
        // ì—ë””í„° ì´ˆê¸°í™”
        if (this.editor) {
          this.editor.innerHTML = '';
        }
        
        // ê°œë³„ í•„ë“œ ì´ˆê¸°í™”
        const fields = [
          'postTitle',
          'postSummary', 
          'postCategory',
          'newCategory',
          'postTags',
          'sourceUrl'
        ];
        
        fields.forEach(fieldId => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.value = '';
          }
        });
        
        // ì´ë¯¸ì§€ ê´€ë ¨ ì´ˆê¸°í™”
        const imageFile = document.getElementById('imageFile');
        const postImage = document.getElementById('postImage');
        const previewImage = document.getElementById('previewImage');
        const imagePreview = document.getElementById('imagePreview');
        const imageInfo = document.getElementById('imageInfo');
        
        if (imageFile) imageFile.value = '';
        if (postImage) postImage.value = '';
        if (previewImage) previewImage.src = '';
        if (imagePreview) imagePreview.style.display = 'none';
        if (imageInfo) imageInfo.textContent = '';
        
        // ì¸ë„¤ì¼ ê´€ë ¨ ì´ˆê¸°í™”
        const thumbnailInput = document.getElementById('nutritionThumbnail');
        const thumbnailUrl = document.getElementById('thumbnailUrl');
        const thumbnailPreview = document.getElementById('thumbnailPreview');
        const thumbnailUploadArea = document.getElementById('thumbnailUploadArea');
        const thumbnailPreviewImg = document.getElementById('thumbnailPreviewImg');
        
        if (thumbnailInput) thumbnailInput.value = '';
        if (thumbnailUrl) thumbnailUrl.value = '';
        if (thumbnailPreview) thumbnailPreview.style.display = 'none';
        if (thumbnailUploadArea) thumbnailUploadArea.style.display = 'block';
        if (thumbnailPreviewImg) thumbnailPreviewImg.src = '';
        
        // í¸ì§‘ ëª¨ë“œ ì´ˆê¸°í™”
        if (typeof window.currentEditingPostId !== 'undefined') {
          window.currentEditingPostId = null;
        }
        
        // ì „ì—­ ë³€ìˆ˜ë¡œë„ ì„¤ì •
        if (typeof currentEditingPostId !== 'undefined') {
          currentEditingPostId = null;
        }
        
        // ì „ì—­ resetForm í•¨ìˆ˜ë„ í˜¸ì¶œ (admin.js)
        if (typeof resetForm === 'function') {
          resetForm();
        }
        
        console.log('í¼ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }

      bindTableModalEvents() {
        const modal = document.getElementById('tableInsertModal');
        const closeBtn = document.getElementById('tableInsertClose');
        const cancelBtn = document.getElementById('tableInsertCancel');
        const confirmBtn = document.getElementById('tableInsertConfirm');

        closeBtn?.addEventListener('click', () => {
          modal.classList.remove('active');
        });

        cancelBtn?.addEventListener('click', () => {
          modal.classList.remove('active');
        });

        confirmBtn?.addEventListener('click', () => {
          this.insertTable();
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        modal?.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.classList.remove('active');
          }
        });
      }

      insertImage() {
        const urlInput = document.getElementById('imageUrl');
        const altInput = document.getElementById('imageAlt');
        const fileInput = document.getElementById('descriptionImageInput');

        if (fileInput.files && fileInput.files[0]) {
          // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
          const file = fileInput.files[0];
          const reader = new FileReader();
          reader.onload = (e) => {
            const html = `<img src="${e.target.result}" alt="${altInput.value || ''}" style="max-width: 100%; height: auto;">`;
            this.insertHtmlIntoEditor(html);
          };
          reader.readAsDataURL(file);
        } else if (urlInput.value) {
          // URLë¡œ ì´ë¯¸ì§€ ì‚½ì…
          const html = `<img src="${urlInput.value}" alt="${altInput.value || ''}" style="max-width: 100%; height: auto;">`;
          this.insertHtmlIntoEditor(html);
        }

        // ëª¨ë‹¬ ë‹«ê¸° ë° ì…ë ¥ê°’ ì´ˆê¸°í™”
        document.getElementById('imageInsertModal').classList.remove('active');
        urlInput.value = '';
        altInput.value = '';
        fileInput.value = '';
      }

      insertTable() {
        const rows = parseInt(document.getElementById('tableRows').value) || 3;
        const cols = parseInt(document.getElementById('tableCols').value) || 2;
        const hasHeader = document.getElementById('tableHeader').checked;

        let html = '<table border="1" style="border-collapse: collapse; width: 100%; margin: 10px 0;">';
        
        for (let i = 0; i < rows; i++) {
          html += '<tr>';
          for (let j = 0; j < cols; j++) {
            if (i === 0 && hasHeader) {
              html += '<th style="padding: 8px; background: #f5f5f5; border: 1px solid #ddd;">í—¤ë”</th>';
            } else {
              html += '<td style="padding: 8px; border: 1px solid #ddd;">ë‚´ìš©</td>';
            }
          }
          html += '</tr>';
        }
        html += '</table>';

        this.insertHtmlIntoEditor(html);

        // ëª¨ë‹¬ ë‹«ê¸°
        document.getElementById('tableInsertModal').classList.remove('active');
      }

      applyImageAlignment(align) {
        if (!this.editor) return;

        this.restoreEditorSelection();
        const selection = window.getSelection();
        let targetImage = null;

        if (selection && selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const container = range.commonAncestorContainer;
          
          if (container.nodeType === Node.ELEMENT_NODE && container.tagName === 'IMG') {
            targetImage = container;
          } else if (container.nodeType === Node.TEXT_NODE && container.parentElement.tagName === 'IMG') {
            targetImage = container.parentElement;
          } else {
            const imgs = container.querySelectorAll ? container.querySelectorAll('img') : [];
            if (imgs.length === 1) {
              targetImage = imgs[0];
            }
          }
        }

        if (!targetImage && this.lastClickedImage && this.editor.contains(this.lastClickedImage)) {
          targetImage = this.lastClickedImage;
        }

        if (targetImage) {
          this.alignImageNode(targetImage, align);
        }
      }

      alignImageNode(img, align) {
        // ê¸°ì¡´ ì •ë ¬ í´ë˜ìŠ¤ ì œê±°
        img.classList.remove('apf-img-center', 'apf-img-left', 'apf-img-right', 'apf-img-none');
        
        // ìƒˆ ì •ë ¬ í´ë˜ìŠ¤ ì¶”ê°€
        if (align !== 'none') {
          img.classList.add(`apf-img-${align}`);
        }
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì—ë””í„° ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      // ì˜ì–‘ì •ë³´ ì„¹ì…˜ì´ í™œì„±í™”ë  ë•Œ ì—ë””í„° ì´ˆê¸°í™”
      const nutritionSection = document.getElementById('nutritionSection');
      if (nutritionSection) {
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
              if (nutritionSection.style.display !== 'none' && !window.nutritionPostEditor) {
                window.nutritionPostEditor = new NutritionPostEditor();
              }
            }
          });
        });
        observer.observe(nutritionSection, { attributes: true });
      }
    });

    // í”„ë¡œëª¨ì…˜ ê´€ë¦¬ ê¸°ëŠ¥
    let currentPromotionId = null;
    let promotions = [];

    // í”„ë¡œëª¨ì…˜ ëª©ë¡ ë¡œë“œ
    async function loadPromotions() {
      try {
        const response = await fetch('/api/promotions/admin', {
          credentials: 'include'
        });
        const data = await response.json();
        
        if (data.success) {
          promotions = data.promotions;
          renderPromotions();
        } else {
          alert('í”„ë¡œëª¨ì…˜ ë¡œë“œ ì‹¤íŒ¨: ' + data.message);
        }
      } catch (error) {
        console.error('í”„ë¡œëª¨ì…˜ ë¡œë“œ ì˜¤ë¥˜:', error);
        alert('í”„ë¡œëª¨ì…˜ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // í”„ë¡œëª¨ì…˜ ëª©ë¡ ë Œë”ë§
    function renderPromotions() {
      const grid = document.getElementById('promotionsGrid');
      if (!grid) return;

      grid.innerHTML = promotions.map(promo => `
        <div class="promotion-card-admin" data-id="${promo.id}">
          <div class="promotion-preview">
            <div class="promotion-theme ${promo.theme}">
              ${promo.badge ? `<div class="promotion-badge">${promo.badge}</div>` : ''}
              <div class="promotion-content">
                <h4>${promo.title}</h4>
                <p>${promo.subtitle || ''}</p>
                <p>${promo.description || ''}</p>
                ${promo.tag ? `<span class="promotion-tag">${promo.tag}</span>` : ''}
              </div>
              ${promo.image_url ? `<img src="${promo.image_url}" alt="${promo.title}">` : ''}
            </div>
          </div>
          <div class="promotion-info">
            <div class="promotion-meta">
              <span class="order">ìˆœì„œ: ${promo.display_order}</span>
              <span class="status ${promo.is_active ? 'active' : 'inactive'}">
                ${promo.is_active ? 'í™œì„±' : 'ë¹„í™œì„±'}
              </span>
            </div>
            <div class="promotion-actions">
              <button onclick="editPromotion(${promo.id})" class="btn-edit">ìˆ˜ì •</button>
              <button onclick="togglePromotion(${promo.id})" class="btn-toggle">
                ${promo.is_active ? 'ë¹„í™œì„±í™”' : 'í™œì„±í™”'}
              </button>
              <button onclick="deletePromotion(${promo.id})" class="btn-delete">ì‚­ì œ</button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // í”„ë¡œëª¨ì…˜ ê²€ìƒ‰ í•„í„°
    function filterPromotions() {
      const searchTerm = document.getElementById('promotionSearch').value.toLowerCase();
      const cards = document.querySelectorAll('.promotion-card-admin');
      
      cards.forEach(card => {
        const title = card.querySelector('h4').textContent.toLowerCase();
        const subtitle = card.querySelector('p').textContent.toLowerCase();
        const description = card.querySelectorAll('p')[1]?.textContent.toLowerCase() || '';
        
        if (title.includes(searchTerm) || subtitle.includes(searchTerm) || description.includes(searchTerm)) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    }

    // í”„ë¡œëª¨ì…˜ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
    function openPromotionForm(promotionId = null) {
      currentPromotionId = promotionId;
      const modal = document.getElementById('promotionModal');
      const title = document.getElementById('promotionModalTitle');
      const form = document.getElementById('promotionForm');
      
      if (promotionId) {
        // ìˆ˜ì • ëª¨ë“œ
        const promotion = promotions.find(p => p.id === promotionId);
        if (promotion) {
          title.textContent = 'í”„ë¡œëª¨ì…˜ ìˆ˜ì •';
          fillPromotionForm(promotion);
        }
      } else {
        // ì¶”ê°€ ëª¨ë“œ
        title.textContent = 'ìƒˆ í”„ë¡œëª¨ì…˜ ì¶”ê°€';
        form.reset();
      }
      
      modal.classList.add('active');
    }

    // í”„ë¡œëª¨ì…˜ í¼ì— ë°ì´í„° ì±„ìš°ê¸°
    function fillPromotionForm(promotion) {
      document.getElementById('promotionTitle').value = promotion.title;
      document.getElementById('promotionSubtitle').value = promotion.subtitle || '';
      document.getElementById('promotionDescription').value = promotion.description || '';
      document.getElementById('promotionBadge').value = promotion.badge || '';
      document.getElementById('promotionTag').value = promotion.tag || '';
      document.getElementById('promotionTheme').value = promotion.theme;
      document.getElementById('promotionImageUrl').value = promotion.image_url || '';
      document.getElementById('promotionDisplayOrder').value = promotion.display_order || 0;
      document.getElementById('promotionIsActive').value = promotion.is_active.toString();
      
      if (promotion.icons) {
        const icons = Array.isArray(promotion.icons) ? promotion.icons : JSON.parse(promotion.icons);
        document.getElementById('promotionIcons').value = icons.join(',');
      } else {
        document.getElementById('promotionIcons').value = '';
      }
      
      if (promotion.start_date) {
        document.getElementById('promotionStartDate').value = promotion.start_date.slice(0, 16);
      } else {
        document.getElementById('promotionStartDate').value = '';
      }
      
      if (promotion.end_date) {
        document.getElementById('promotionEndDate').value = promotion.end_date.slice(0, 16);
      } else {
        document.getElementById('promotionEndDate').value = '';
      }
    }

    // í”„ë¡œëª¨ì…˜ ëª¨ë‹¬ ë‹«ê¸°
    function closePromotionModal() {
      document.getElementById('promotionModal').classList.remove('active');
      currentPromotionId = null;
    }

    // í”„ë¡œëª¨ì…˜ ìˆ˜ì •
    function editPromotion(id) {
      openPromotionForm(id);
    }

    // í”„ë¡œëª¨ì…˜ í™œì„±í™”/ë¹„í™œì„±í™” í† ê¸€
    async function togglePromotion(id) {
      try {
        const response = await fetch(`/api/promotions/${id}/toggle`, {
          method: 'PUT',
          credentials: 'include'
        });
        const data = await response.json();
        
        if (data.success) {
          alert(data.message);
          await loadPromotions();
        } else {
          alert('ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ' + data.message);
        }
              } catch (error) {
          console.error('í”„ë¡œëª¨ì…˜ í† ê¸€ ì˜¤ë¥˜:', error);
          alert('ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // í”„ë¡œëª¨ì…˜ ì‚­ì œ
    async function deletePromotion(id) {
      if (!confirm('ì •ë§ë¡œ ì´ í”„ë¡œëª¨ì…˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      try {
        const response = await fetch(`/api/promotions/${id}`, {
          method: 'DELETE',
          credentials: 'include'
        });
        const data = await response.json();
        
        if (data.success) {
          alert(data.message);
          await loadPromotions();
        } else {
          alert('ì‚­ì œ ì‹¤íŒ¨: ' + data.message);
        }
              } catch (error) {
          console.error('í”„ë¡œëª¨ì…˜ ì‚­ì œ ì˜¤ë¥˜:', error);
          alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // í”„ë¡œëª¨ì…˜ í¼ ì œì¶œ ì²˜ë¦¬
    document.addEventListener('DOMContentLoaded', function() {
      const promotionForm = document.getElementById('promotionForm');
      if (promotionForm) {
        promotionForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = {
        title: document.getElementById('promotionTitle').value,
        subtitle: document.getElementById('promotionSubtitle').value,
        description: document.getElementById('promotionDescription').value,
        badge: document.getElementById('promotionBadge').value,
        tag: document.getElementById('promotionTag').value,
        theme: document.getElementById('promotionTheme').value,
        image_url: document.getElementById('promotionImageUrl').value,
        display_order: parseInt(document.getElementById('promotionDisplayOrder').value) || 0,
        is_active: document.getElementById('promotionIsActive').value === 'true',
        start_date: document.getElementById('promotionStartDate').value || null,
        end_date: document.getElementById('promotionEndDate').value || null
      };
      
      // ì•„ì´ì½˜ ì²˜ë¦¬
      const iconsInput = document.getElementById('promotionIcons').value;
      if (iconsInput.trim()) {
        formData.icons = iconsInput.split(',').map(icon => icon.trim()).filter(icon => icon);
      }
      
      try {
        const url = currentPromotionId ? `/api/promotions/${currentPromotionId}` : '/api/promotions';
        const method = currentPromotionId ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
          method: method,
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include',
          body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert(data.message);
          closePromotionModal();
          await loadPromotions();
        } else {
          alert('ì €ì¥ ì‹¤íŒ¨: ' + data.message);
        }
              } catch (error) {
          console.error('í”„ë¡œëª¨ì…˜ ì €ì¥ ì˜¤ë¥˜:', error);
          alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    });
      }
    });

    // í˜ì´ì§€ê´€ë¦¬ íƒ­ í´ë¦­ ì‹œ í”„ë¡œëª¨ì…˜ ë¡œë“œ
    const promotionsTab = document.querySelector('[data-section="promotions"]');
    if (promotionsTab) {
      promotionsTab.addEventListener('click', function() {
        loadPromotions();
      });
    }
  </script>
</body>
</html>