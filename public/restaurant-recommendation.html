<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì‹ë‹¹ ì¶”ì²œ</title>
    <link rel="stylesheet" href="style.css">
    <!-- ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ë¹„ë™ê¸° ë°©ì‹ìœ¼ë¡œ ë¡œë“œ -->
    <script>
        // ì¹´ì¹´ì˜¤ë§µ API ë¹„ë™ê¸° ë¡œë”©
        (function() {
            // ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ì²˜ë¦¬
            if (typeof kakao !== 'undefined') {
                return;
            }

            // ì„œë²„ì—ì„œ API í‚¤ë¥¼ ê°€ì ¸ì™€ì„œ ì¹´ì¹´ì˜¤ë§µ ë¡œë“œ
            fetch('/api/kakao-map-key')
                .then(response => response.json())
                .then(data => {
                    if (!data.apiKey) {
                        console.error('ì¹´ì¹´ì˜¤ë§µ API í‚¤ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        if (window.restaurantRecommendation) {
                            window.restaurantRecommendation.handleMapLoadError();
                        }
                        return;
                    }

                    var script = document.createElement('script');
                    script.type = 'text/javascript';
                    script.src = `//dapi.kakao.com/v2/maps/sdk.js?appkey=${data.apiKey}&libraries=services&autoload=false`;
                    script.async = true;
                    script.defer = true;
            
                                // ë¡œë”© íƒ€ì„ì•„ì›ƒ ì„¤ì •
                    var loadTimeout = setTimeout(function() {
                        console.warn('ì¹´ì¹´ì˜¤ë§µ API ë¡œë”© íƒ€ì„ì•„ì›ƒ');
                        if (window.restaurantRecommendation) {
                            window.restaurantRecommendation.handleMapLoadError();
                        }
                    }, 10000); // 10ì´ˆ íƒ€ì„ì•„ì›ƒ
                    
                    script.onload = function() {
                        clearTimeout(loadTimeout);
                        
                        // API ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™” (ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€)
                        if (typeof kakao !== 'undefined') {
                            try {
                                kakao.maps.load(function() {
                                    console.log('ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ ì™„ë£Œ');
                                    // DOMContentLoadedì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
                                });
                            } catch (error) {
                                console.error('ì¹´ì¹´ì˜¤ë§µ API ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                                if (window.restaurantRecommendation) {
                                    window.restaurantRecommendation.handleMapLoadError();
                                }
                            }
                        } else {
                            console.error('ì¹´ì¹´ì˜¤ë§µ API ê°ì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                            if (window.restaurantRecommendation) {
                                window.restaurantRecommendation.handleMapLoadError();
                            }
                        }
                    };
                    
                    script.onerror = function() {
                        clearTimeout(loadTimeout);
                        console.error('ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ ì‹¤íŒ¨');
                        // API ë¡œë“œ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ì²˜ë¦¬
                        if (window.restaurantRecommendation) {
                            window.restaurantRecommendation.handleMapLoadError();
                        }
                    };
                    
                    document.head.appendChild(script);
                })
                .catch(error => {
                    console.error('API í‚¤ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                    if (window.restaurantRecommendation) {
                        window.restaurantRecommendation.handleMapLoadError();
                    }
                });
        })();
    </script>
</head>
<body class="restaurant-page">
    <div class="site-brand-fixed"><a href="index.html">ì‡í”Œ</a></div>
    <div class="auth-links">
        <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
    </div>

    <div class="recommendation-container">

        <!-- 1ë‹¨ê³„: ìœ„ì¹˜ ì„¤ì • -->
        <div class="step-content active" id="step1">
            <div class="step-container">
                <div class="step-title">ğŸ“ 1ë‹¨ê³„: ìœ„ì¹˜ ì„¤ì •</div>
                <div class="step-description">
                    <p>ì§€ë„ì—ì„œ ì›í•˜ëŠ” ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ê±°ë‚˜ í˜„ì¬ ìœ„ì¹˜ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.</p>
                </div>
                
                <!-- ì¹´ì¹´ì˜¤ ì§€ë„ -->
                <div class="map-container">
                    <div id="map" class="kakao-map"></div>
                </div>
                
                <!-- ìœ„ì¹˜ ì •ë³´ -->
                <div class="location-info">
                    <div class="location-input-group">
                        <label>ì£¼ì†Œ ê²€ìƒ‰</label>
                        <div class="address-search-container">
                            <input type="text" id="addressSearch" class="address-search-input" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (êµ¬/ë™/ë„ë¡œëª… ì¤‘ í•˜ë‚˜, ì˜ˆ: ê°•ë‚¨êµ¬, ì—­ì‚¼ë™, í…Œí—¤ë€ë¡œ)">
                            <button type="button" id="searchAddressBtn" class="address-search-btn address-search-btn-custom">ğŸ” ê²€ìƒ‰</button>
                        </div>
                    </div>
                    <div class="location-input-group">
                        <label>ì„ íƒí•œ ìœ„ì¹˜</label>
                        <input type="text" id="address" class="location-input" placeholder="ì§€ë„ì—ì„œ ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì£¼ì†Œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”" readonly>
                    </div>
                </div>
                
                <!-- ìœ„ì¹˜ ì„¤ì • ë²„íŠ¼ -->
                <div class="location-buttons">
                    <button class="location-btn location-btn-secondary" onclick="getCurrentLocation()">
                        ğŸ“ í˜„ì¬ ìœ„ì¹˜ ì‚¬ìš©
                    </button>
                    <button class="location-btn location-btn-primary" onclick="confirmLocation()" id="confirmLocationBtn" disabled>
                        âœ… ìœ„ì¹˜ í™•ì¸ ì™„ë£Œ
                    </button>
                </div>
            </div>
        </div>

        <!-- 2ë‹¨ê³„: ì‚¬ìš©ì í”„ë¡œí•„ -->
        <div class="step-content" id="step2">
            <div class="step-container">
                <div class="step-title">ğŸ‘¤ 2ë‹¨ê³„: ì‚¬ìš©ì í”„ë¡œí•„</div>
                <div class="step-description">
                    <p>AIê°€ ë” ì •í™•í•œ ì¶”ì²œì„ í•  ìˆ˜ ìˆë„ë¡ í”„ë¡œí•„ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                </div>
                
                <div class="progress-container">
                    <div id="profileProgressBar" class="progress-bar"></div>
                    <div class="progress-step active" data-step="1" data-text="ê¸°ë³¸ì •ë³´"></div>
                    <div class="progress-step" data-step="2" data-text="ê±´ê°•ì •ë³´"></div>
                    <div class="progress-step" data-step="3" data-text="ì¶”ê°€ì •ë³´"></div>
                </div>
                
                <form id="profileForm" onsubmit="return false;" action="javascript:void(0)">
                    <div id="profileSection1" class="profile-section active">
                        <div class="section-guide required">
                            ê¸°ë³¸ ì‹ ì²´ ì •ë³´ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”. ì •í™•í•œ ì •ë³´ì¼ìˆ˜ë¡ ë” ë‚˜ì€ ë§ì¶¤ ì‹ë‹¹ì„ ì¶”ì²œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                        <div class="input-row">
                            <div class="input-group-item">
                                <label for="age">ë‚˜ì´:</label>
                                <span id="age-error" class="error-message"></span>
                                <input type="number" id="age" name="age" min="1" max="120" required>
                            </div>
                            <div class="input-group-item">
                                <label for="height">í‚¤ (cm):</label>
                                <span id="height-error" class="error-message"></span>
                                <input type="number" id="height" name="height" min="100" max="250" step="0.1" required>
                            </div>
                            <div class="input-group-item">
                                <label for="weight">ì²´ì¤‘ (kg):</label>
                                <span id="weight-error" class="error-message"></span>
                                <input type="number" id="weight" name="weight" min="20" max="200" step="0.1" required>
                            </div>
                        </div>
                        
                        <label>ì„±ë³„:</label>
                        <div class="option-group" data-name="gender">
                            <div class="option" data-value="male" role="button" tabindex="0">ë‚¨ì„±</div>
                            <div class="option" data-value="female" role="button" tabindex="0">ì—¬ì„±</div>
                        </div>
                        <label>í™œë™ëŸ‰:</label>
                        <div class="option-group" data-name="activity_level">
                            <div class="option" data-value="sedentary" role="button" tabindex="0">ì¢Œì‹ ìƒí™œ (ìš´ë™ ê±°ì˜ ì•ˆí•¨)</div>
                            <div class="option" data-value="light" role="button" tabindex="0">ê°€ë²¼ìš´ í™œë™ (ì£¼ 1-3íšŒ ìš´ë™)</div>
                            <div class="option" data-value="moderate" role="button" tabindex="0">ë³´í†µ í™œë™ (ì£¼ 3-5íšŒ ìš´ë™)</div>
                            <div class="option" data-value="active" role="button" tabindex="0">í™œë°œí•œ í™œë™ (ì£¼ 6-7íšŒ ìš´ë™)</div>
                            <div class="option" data-value="very_active" role="button" tabindex="0">ë§¤ìš° í™œë°œí•¨ (í•˜ë£¨ 2íšŒ ì´ìƒ ìš´ë™)</div>
                        </div>
                        <label>ì‹ì‚¬ íŒ¨í„´:</label>
                        <div class="option-group" data-name="eating_patterns">
                            <div class="option" data-value="regular" role="button" tabindex="0">ê·œì¹™ì  (ì •í•´ì§„ ì‹œê°„ì— ì‹ì‚¬)</div>
                            <div class="option" data-value="irregular" role="button" tabindex="0">ë¶ˆê·œì¹™ì </div>
                            <div class="option" data-value="intermittent_fasting" role="button" tabindex="0">ê°„í—ì  ë‹¨ì‹</div>
                        </div>
                        <label>ìˆ˜ë©´ íŒ¨í„´:</label>
                        <div class="option-group" data-name="sleep_patterns">
                            <div class="option" data-value="less_than_6" role="button" tabindex="0">6ì‹œê°„ ë¯¸ë§Œ</div>
                            <div class="option" data-value="6_to_8" role="button" tabindex="0">6-8ì‹œê°„</div>
                            <div class="option" data-value="more_than_8" role="button" tabindex="0">8ì‹œê°„ ì´ìƒ</div>
                        </div>
                        <label>í•˜ë£¨ ì‹ì‚¬ íšŸìˆ˜:</label>
                        <div class="option-group" data-name="meals_per_day">
                            <div class="option" data-value="1" role="button" tabindex="0">1íšŒ</div>
                            <div class="option" data-value="2" role="button" tabindex="0">2íšŒ</div>
                            <div class="option" data-value="3" role="button" tabindex="0">3íšŒ</div>
                            <div class="option" data-value="4" role="button" tabindex="0">4íšŒ</div>
                        </div>
                        <label>ìŒì£¼ ì—¬ë¶€:</label>
                        <div class="option-group" data-name="alcohol_consumption">
                            <div class="option" data-value="none" role="button" tabindex="0">ì—†ìŒ</div>
                            <div class="option" data-value="socially" role="button" tabindex="0">ì‚¬íšŒì  ìŒì£¼ (ì›” 1~2íšŒ)</div>
                            <div class="option" data-value="weekly_light" role="button" tabindex="0">ì£¼ 1íšŒ ê°€ë³ê²Œ (1ë³‘ ì´ë‚´)</div>
                            <div class="option" data-value="weekly_moderate" role="button" tabindex="0">ì£¼ 1~2íšŒ ì ë‹¹íˆ (1ë³‘ ì´ìƒ)</div>
                            <div class="option" data-value="frequent" role="button" tabindex="0">ì¦ì€ ìŒì£¼ (ì£¼ 3íšŒ ì´ìƒ)</div>
                        </div>
                        <label>í¡ì—° ì—¬ë¶€:</label>
                        <div class="option-group" data-name="smoking_status">
                            <div class="option" data-value="smoker" role="button" tabindex="0">í¡ì—°</div>
                            <div class="option" data-value="non_smoker" role="button" tabindex="0">ë¹„í¡ì—°</div>
                        </div>
                        <div class="button-group">
                            <button type="button" onclick="nextRestaurantProfileSection(1)" class="next-button">ë‹¤ìŒ</button>
                        </div>
                    </div>

                    <div id="profileSection2" class="profile-section">
                        <div class="section-guide optional">
                            ê±´ê°• ê´€ë ¨ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. ì´ ì •ë³´ëŠ” ë” ì •í™•í•œ ì‹ë‹¹ ì¶”ì²œì„ ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.
                        </div>
                        <div class="accordion">
                            <div class="accordion-header">ì•Œë ˆë¥´ê¸° (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</div>
                            <div class="accordion-content">
                                <div class="option-group" data-name="allergies">
                                    <div class="option" data-value="none" role="button" tabindex="0">ì—†ìŒ</div>
                                    <div class="option" data-value="peanuts" role="button" tabindex="0">ë•…ì½©</div>
                                    <div class="option" data-value="tree_nuts" role="button" tabindex="0">ê²¬ê³¼ë¥˜</div>
                                    <div class="option" data-value="milk" role="button" tabindex="0">ìš°ìœ </div>
                                    <div class="option" data-value="eggs" role="button" tabindex="0">ê³„ë€</div>
                                    <div class="option" data-value="fish" role="button" tabindex="0">ìƒì„ </div>
                                    <div class="option" data-value="shellfish" role="button" tabindex="0">ê°‘ê°ë¥˜</div>
                                    <div class="option" data-value="soy" role="button" tabindex="0">ì½©</div>
                                    <div class="option" data-value="wheat" role="button" tabindex="0">ë°€</div>
                                    <div class="option" data-value="sesame" role="button" tabindex="0">ì°¸ê¹¨</div>
                                    <div class="option" data-value="other_allergy_toggle" role="button" tabindex="0">ê¸°íƒ€ (ì§ì ‘ ì…ë ¥)</div>
                                </div>
                                <div id="otherAllergyInput" class="hidden-input-container">
                                    <label for="other_allergies_text">ê¸°íƒ€ ì•Œë ˆë¥´ê¸° ì‹í’ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”:</label>
                                    <input type="text" id="other_allergies_text" name="other_allergies_text" placeholder="ì˜ˆ: í‚¤ìœ„, í† ë§ˆí†  ë“±">
                                </div>
                            </div>
                        </div>
                        <div class="accordion">
                            <div class="accordion-header">í˜„ì¬ ì•“ê³  ìˆëŠ” ì§ˆë³‘ (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</div>
                            <div class="accordion-content">
                                <div class="option-group" data-name="illnesses">
                                    <div class="option" data-value="none" role="button" tabindex="0">ì—†ìŒ</div>
                                    <div class="option" data-value="diabetes" role="button" tabindex="0">ë‹¹ë‡¨ë³‘</div>
                                    <div class="option" data-value="hypertension" role="button" tabindex="0">ê³ í˜ˆì••</div>
                                    <div class="option" data-value="heart_disease" role="button" tabindex="0">ì‹¬ì¥ë³‘</div>
                                    <div class="option" data-value="kidney_disease" role="button" tabindex="0">ì‹ ì¥ë³‘</div>
                                    <div class="option" data-value="liver_disease" role="button" tabindex="0">ê°„ ì§ˆí™˜</div>
                                    <div class="option" data-value="osteoporosis" role="button" tabindex="0">ê³¨ë‹¤ê³µì¦</div>
                                    <div class="option" data-value="anemia" role="button" tabindex="0">ë¹ˆí˜ˆ</div>
                                    <div class="option" data-value="thyroid_disorder" role="button" tabindex="0">ê°‘ìƒì„  ì§ˆí™˜</div>
                                    <div class="option" data-value="gastritis" role="button" tabindex="0">ìœ„ì—¼</div>
                                    <div class="option" data-value="ibs" role="button" tabindex="0">ê³¼ë¯¼ì„± ëŒ€ì¥ ì¦í›„êµ°</div>
                                    <div class="option" data-value="other_illness_toggle" role="button" tabindex="0">ê¸°íƒ€ (ì§ì ‘ ì…ë ¥)</div>
                                </div>
                                <div id="otherIllnessInput" class="hidden-input-container">
                                    <label for="other_illnesses_text">ê¸°íƒ€ ì§ˆë³‘ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:</label>
                                    <input type="text" id="other_illnesses_text" name="other_illnesses_text" placeholder="ì˜ˆ: ê³ ì§€í˜ˆì¦, ê´€ì ˆì—¼ ë“±">
                                </div>
                            </div>
                        </div>
                        <div class="button-group">
                            <button type="button" onclick="prevRestaurantProfileSection(2)" class="prev-button">ì´ì „</button>
                            <button type="button" onclick="nextRestaurantProfileSection(2)" class="next-button">ë‹¤ìŒ</button>
                        </div>
                    </div>

                    <div id="profileSection3" class="profile-section">
                        <div class="section-guide optional">
                            ë” ì •í™•í•œ ì‹ë‹¹ ì¶”ì²œì„ ìœ„í•œ ì¶”ê°€ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì„ íƒì‚¬í•­)
                        </div>
                        <div class="accordion">
                            <div class="accordion-header">ìµœê·¼ ê±´ê°•ê²€ì§„ ìˆ˜ì¹˜ (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</div>
                            <div class="accordion-content">
                                <div class="option-group" data-name="biomarkers">
                                    <div class="option" data-value="none" role="button" tabindex="0">ì—†ìŒ</div>
                                    <div class="option" data-value="blood_glucose" role="button" tabindex="0">
                                        í˜ˆë‹¹ <span class="unit">(mg/dL)</span>
                                        <input type="number" name="blood_glucose_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="hba1c" role="button" tabindex="0">
                                        ë‹¹í™”í˜ˆìƒ‰ì†Œ <span class="unit">(%)</span>
                                        <input type="number" name="hba1c_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0" step="0.1">
                                    </div>
                                    <div class="option" data-value="total_cholesterol" role="button" tabindex="0">
                                        ì´ ì½œë ˆìŠ¤í…Œë¡¤ <span class="unit">(mg/dL)</span>
                                        <input type="number" name="total_cholesterol_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="ldl_cholesterol" role="button" tabindex="0">
                                        LDL ì½œë ˆìŠ¤í…Œë¡¤ <span class="unit">(mg/dL)</span>
                                        <input type="number" name="ldl_cholesterol_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="hdl_cholesterol" role="button" tabindex="0">
                                        HDL ì½œë ˆìŠ¤í…Œë¡¤ <span class="unit">(mg/dL)</span>
                                        <input type="number" name="hdl_cholesterol_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="triglycerides" role="button" tabindex="0">
                                        ì¤‘ì„±ì§€ë°© <span class="unit">(mg/dL)</span>
                                        <input type="number" name="triglycerides_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="blood_pressure_systolic" role="button" tabindex="0">
                                        ìˆ˜ì¶•ê¸° í˜ˆì•• <span class="unit">(mmHg)</span>
                                        <input type="number" name="blood_pressure_systolic_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="blood_pressure_diastolic" role="button" tabindex="0">
                                        ì´ì™„ê¸° í˜ˆì•• <span class="unit">(mmHg)</span>
                                        <input type="number" name="blood_pressure_diastolic_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="bmi" role="button" tabindex="0">
                                        BMI <span class="unit">(kg/mÂ²)</span>
                                        <input type="number" name="bmi_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0" step="0.1">
                                    </div>
                                    <div class="option" data-value="other_biomarker_toggle" role="button" tabindex="0">ê¸°íƒ€ (ì§ì ‘ ì…ë ¥)</div>
                                </div>
                                <div id="otherBiomarkerInput" class="hidden-input-container">
                                    <label for="other_biomarkers_text">ê¸°íƒ€ ê±´ê°•ê²€ì§„ ìˆ˜ì¹˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:</label>
                                    <input type="text" id="other_biomarkers_text" name="other_biomarkers_text" placeholder="ì˜ˆ: ìš”ì‚°, í¬ë ˆì•„í‹°ë‹Œ ë“±">
                                </div>
                            </div>
                        </div>
                        <div class="accordion">
                            <div class="accordion-header">ì„­ì·¨ ì¤‘ì¸ ê±´ê°•ê¸°ëŠ¥ì‹í’ˆ (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</div>
                            <div class="accordion-content">
                                <div class="option-group" data-name="supplements">
                                    <div class="option" data-value="none" role="button" tabindex="0">ì—†ìŒ</div>
                                    <div class="option" data-value="vitamin_a" role="button" tabindex="0">
                                        ë¹„íƒ€ë¯¼ A <span class="unit">(Î¼g)</span>
                                        <input type="number" name="vitamin_a_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="vitamin_d" role="button" tabindex="0">
                                        ë¹„íƒ€ë¯¼ D <span class="unit">(IU)</span>
                                        <input type="number" name="vitamin_d_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="vitamin_e" role="button" tabindex="0">
                                        ë¹„íƒ€ë¯¼ E <span class="unit">(mg)</span>
                                        <input type="number" name="vitamin_e_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="vitamin_k" role="button" tabindex="0">
                                        ë¹„íƒ€ë¯¼ K <span class="unit">(Î¼g)</span>
                                        <input type="number" name="vitamin_k_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="iron" role="button" tabindex="0">
                                        ì² ë¶„ <span class="unit">(mg)</span>
                                        <input type="number" name="iron_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="calcium" role="button" tabindex="0">
                                        ì¹¼ìŠ˜ <span class="unit">(mg)</span>
                                        <input type="number" name="calcium_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="magnesium" role="button" tabindex="0">
                                        ë§ˆê·¸ë„¤ìŠ˜ <span class="unit">(mg)</span>
                                        <input type="number" name="magnesium_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="potassium" role="button" tabindex="0">
                                        ì¹¼ë¥¨ <span class="unit">(mg)</span>
                                        <input type="number" name="potassium_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="zinc" role="button" tabindex="0">
                                        ì•„ì—° <span class="unit">(mg)</span>
                                        <input type="number" name="zinc_value" placeholder="ìˆ˜ì¹˜" class="value-input hidden" min="0">
                                    </div>
                                    <div class="option" data-value="other_supplement_toggle" role="button" tabindex="0">ê¸°íƒ€ (ì§ì ‘ ì…ë ¥)</div>
                                </div>
                                <div id="otherSupplementInput" class="hidden-input-container">
                                    <label for="other_supplements_text">ê¸°íƒ€ ê±´ê°•ê¸°ëŠ¥ì‹í’ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”:</label>
                                    <input type="text" id="other_supplements_text" name="other_supplements_text" placeholder="ì˜ˆ: ì½œë¼ê², ë°€í¬ì”¨ìŠ¬">
                                </div>
                            </div>
                        </div>
                        <div class="button-group">
                            <button type="button" onclick="prevRestaurantProfileSection(3)" class="prev-button">ì´ì „</button>
                            <button type="button" class="save-button" onclick="saveRestaurantProfile(event)">ì €ì¥</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- 3ë‹¨ê³„: ìš”êµ¬ì‚¬í•­ -->
        <div class="step-content" id="step3">
            <div class="step-container">
                <div class="step-title">ğŸ’­ 3ë‹¨ê³„: ì‹ë‹¹ ì¡°ê±´</div>
                <div class="step-description">
                    <p>ì›í•˜ëŠ” ì‹ë‹¹ì˜ ì¡°ê±´ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                </div>
                
                <div class="requirement-section">
                    <div class="requirement-group">
                        <label>ìŒì‹ ì¹´í…Œê³ ë¦¬:</label>
                        <div class="category-options">
                            <label class="checkbox-option option-any"><input type="radio" name="food_category" value="ë¬´ê´€"><span class="checkmark"></span><span class="option-text">ë¬´ê´€</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="í•œì‹"><span class="checkmark"></span><span class="option-text">í•œì‹</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="ì¤‘ì‹"><span class="checkmark"></span><span class="option-text">ì¤‘ì‹</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="ì¼ì‹"><span class="checkmark"></span><span class="option-text">ì¼ì‹</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="ì–‘ì‹"><span class="checkmark"></span><span class="option-text">ì–‘ì‹</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="ë¶„ì‹"><span class="checkmark"></span><span class="option-text">ë¶„ì‹</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="ê³ ê¸°/êµ¬ì´"><span class="checkmark"></span><span class="option-text">ê³ ê¸°/êµ¬ì´</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="í•´ì‚°ë¬¼/íšŒ"><span class="checkmark"></span><span class="option-text">í•´ì‚°ë¬¼/íšŒ</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="ì¹˜í‚¨/í”¼ì"><span class="checkmark"></span><span class="option-text">ì¹˜í‚¨/í”¼ì</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="íŒ¨ìŠ¤íŠ¸í‘¸ë“œ"><span class="checkmark"></span><span class="option-text">íŒ¨ìŠ¤íŠ¸í‘¸ë“œ</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="ë¸ŒëŸ°ì¹˜/ìƒŒë“œìœ„ì¹˜"><span class="checkmark"></span><span class="option-text">ë¸ŒëŸ°ì¹˜/ìƒŒë“œìœ„ì¹˜</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="ë² ì´ì»¤ë¦¬/ë””ì €íŠ¸"><span class="checkmark"></span><span class="option-text">ë² ì´ì»¤ë¦¬/ë””ì €íŠ¸</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="ê±´ê°•ì‹/ë¹„ê±´"><span class="checkmark"></span><span class="option-text">ê±´ê°•ì‹/ë¹„ê±´</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="í“¨ì „ìš”ë¦¬"><span class="checkmark"></span><span class="option-text">í“¨ì „ìš”ë¦¬</span></label>
                            <label class="checkbox-option"><input type="radio" name="food_category" value="ìˆ ì§‘/í¬ì°¨"><span class="checkmark"></span><span class="option-text">ìˆ ì§‘/í¬ì°¨</span></label>
                        </div>
                    </div>
                    <div class="requirement-group">
                        <label>ê°€ê²©ëŒ€:</label>
                        <div class="price-options">
                            <label class="checkbox-option">
                                <input type="radio" name="price_range" value="under_10000">
                                <span class="checkmark"></span>
                                <span class="option-text">10,000ì› ì´í•˜</span>
                            </label>
                            <label class="checkbox-option">
                                <input type="radio" name="price_range" value="10000_20000">
                                <span class="checkmark"></span>
                                <span class="option-text">10,000ì› ~ 20,000ì›</span>
                            </label>
                            <label class="checkbox-option">
                                <input type="radio" name="price_range" value="over_20000">
                                <span class="checkmark"></span>
                                <span class="option-text">20,000ì› ì´ìƒ</span>
                            </label>
                            <label class="checkbox-option option-any">
                                <input type="radio" name="price_range" value="no_preference">
                                <span class="checkmark"></span>
                                <span class="option-text">ë¬´ê´€</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="requirement-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="business_open">
                            <span class="checkmark"></span>
                            <span class="label-text">ì§€ê¸ˆ ì˜ì—… ì¤‘ì¸ ê³³ë§Œ ë³´ê¸°</span>
                        </label>
                    </div>
                </div>
                
                <div class="step-navigation">
                    <button class="step-btn step-btn-secondary" onclick="prevStep()">â† ì´ì „</button>
                    <button class="step-btn step-btn-primary" onclick="nextStep()" id="nextStep3Btn">ë‹¤ìŒ â†’</button>
                </div>
            </div>
        </div>

        <!-- 4ë‹¨ê³„: ì¶”ì²œ ì‹œì‘ -->
        <div class="step-content" id="step4">
            <div class="step-container">
                <div class="step-title">ğŸš€ 4ë‹¨ê³„: AI ì¶”ì²œ ì‹œì‘</div>
                <div class="step-description">
                    <p>AIê°€ ì…ë ¥í•˜ì‹  ì •ë³´ë¥¼ ë¶„ì„í•˜ì—¬ ë°˜ê²½ <b>1km</b> ë‚´ì—ì„œ ìµœì ì˜ ì‹ë‹¹ì„ ì¶”ì²œí•©ë‹ˆë‹¤.</p>
                </div>
                
                <!-- ì…ë ¥ ì •ë³´ ìš”ì•½ -->
                <div class="summary-section">
                    <h3>ğŸ“‹ ì…ë ¥ ì •ë³´ ìš”ì•½</h3>
                    <div class="summary-content">
                        <div class="summary-item">
                            <strong>ìœ„ì¹˜:</strong> <span id="summaryLocation">-</span>
                        </div>
                        <div class="summary-item">
                            <strong>ì•Œë ˆë¥´ê¸°:</strong> <span id="summaryAllergies">-</span>
                        </div>
                        <div class="summary-item">
                            <strong>ê±´ê°•ìƒíƒœ:</strong> <span id="summaryHealth">-</span>
                        </div>
                        <div class="summary-item">
                            <strong>ì¶”ê°€ì¡°ê±´:</strong> <span id="summaryPreferences">-</span>
                        </div>
                        <div class="summary-item">
                            <strong>ì˜ˆì‚°:</strong> <span id="summaryBudget">-</span>
                        </div>
                        <div class="summary-item">
                            <strong>ìŒì‹ ì¹´í…Œê³ ë¦¬:</strong> <span id="summaryCategory">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="step-navigation">
                    <button class="step-btn step-btn-secondary" onclick="prevStep()">â† ì´ì „</button>
                    <button class="step-btn step-btn-primary" onclick="startRecommendation()" id="recommendBtn">ğŸ¤– AI ì¶”ì²œ ì‹œì‘</button>
                </div>
            </div>
        </div>

        <!-- 5ë‹¨ê³„: ë¡œë”© -->
        <div class="step-content" id="step5">
            <div class="step-container">
                <div class="step-title">â³ AI ì¶”ì²œ ë¶„ì„ ì¤‘...</div>
                <div class="step-description">
                    <p>ì…ë ¥í•˜ì‹  ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìµœì ì˜ ì‹ë‹¹ì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                
                <div id="loading" class="restaurant-loading" style="display: none;">
                    <div class="restaurant-loading-spinner"></div>
                </div>
            </div>
        </div>

        <!-- ê²°ê³¼ í‘œì‹œ -->
        <div id="resultContainer" class="result-container" style="display: none;">
            <div class="step-container">
                <div class="step-title">ğŸ¯ AI ì¶”ì²œ ê²°ê³¼</div>
                <div id="recommendationResults"></div>
                <div class="step-navigation">
                    <button class="step-btn step-btn-secondary" onclick="restartRecommendation()">ğŸ”„ ë‹¤ì‹œ ì‹œì‘</button>
                </div>
            </div>
        </div>
    </div>

    <!-- í”„ë¡œí•„ ì €ì¥ ì„ íƒ ëª¨ë‹¬ -->
    <div id="profileSaveModal" class="modal" style="display:none;">
        <div class="modal-content">
            <button type="button" class="modal-close" onclick="closeProfileSaveModal()">&times;</button>
            <h3>í”„ë¡œí•„ ì €ì¥ ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”</h3>
            <div class="modal-btn-row">
                <button id="tempSaveBtn" class="modal-btn">ë¹„ë¡œê·¸ì¸ ìƒíƒœë¡œ ì„ì‹œì €ì¥</button>
                <button id="saveAfterLoginBtn" class="modal-btn alt">ë¡œê·¸ì¸ í›„ í”„ë¡œí•„ì— ì €ì¥</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="restaurant-recommendation.js"></script>
    <script>
        // ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œ ì¶”ì²œ ë©”ë‰´ ì„¹ì…˜ ë¸”ëŸ¬ ì²˜ë¦¬
        function applyLoginRestrictions() {
            // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            const isLoggedIn = !!user;
            
            if (!isLoggedIn) {
                // recommended-menus-sectionì„ ì°¾ì•„ì„œ ë¸”ëŸ¬ ì²˜ë¦¬
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        mutation.addedNodes.forEach(function(node) {
                            if (node.nodeType === 1) { // Element node
                                const menuSections = node.querySelectorAll ? node.querySelectorAll('.recommended-menus-section') : [];
                                const isMenuSection = node.classList && node.classList.contains('recommended-menus-section');
                                
                                const sectionsToBlur = isMenuSection ? [node] : Array.from(menuSections);
                                
                                sectionsToBlur.forEach(function(section) {
                                    if (!section.classList.contains('login-required-blur')) {
                                        // ë¸”ëŸ¬ íš¨ê³¼ ì ìš©
                                        section.classList.add('login-required-blur');
                                        
                                        // position ì„¤ì • (ì¤‘ìš”!)
                                        const computedStyle = window.getComputedStyle(section);
                                        if (computedStyle.position === 'static') {
                                            section.style.position = 'relative';
                                        }
                                        
                                        // ì˜¤ë²„ë ˆì´ ë©”ì‹œì§€ ì¶”ê°€
                                        const overlay = document.createElement('div');
                                        overlay.className = 'login-required-overlay';
                                        overlay.innerHTML = `
                                            <div class="login-required-message">
                                                <span class="lock-icon">ğŸ”‘</span>
                                                <span class="message-text">ë¡œê·¸ì¸í•˜ê³  ëª¨ë“  ê¸°ëŠ¥ì„ ì´ìš©í•´ ë³´ì„¸ìš”</span>
                                            </div>
                                        `;
                                        
                                        section.appendChild(overlay);
                                        
                                        // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸
                                        console.log('Restaurant overlay added to:', section);
                                    }
                                });
                            }
                        });
                    });
                });
                
                // DOM ë³€í™” ê°ì§€ ì‹œì‘
                observer.observe(document.body, {
                    childList: true,
                    subtree: true
                });
                
                // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” recommended-menus-section ì²˜ë¦¬
                document.querySelectorAll('.recommended-menus-section').forEach(function(section) {
                    if (!section.classList.contains('login-required-blur')) {
                        section.classList.add('login-required-blur');
                        
                        // position ì„¤ì • (ì¤‘ìš”!)
                        const computedStyle = window.getComputedStyle(section);
                        if (computedStyle.position === 'static') {
                            section.style.position = 'relative';
                        }
                        
                        const overlay = document.createElement('div');
                        overlay.className = 'login-required-overlay';
                        overlay.innerHTML = `
                            <div class="login-required-message">
                                <span class="lock-icon">ğŸ”‘</span>
                                <span class="message-text">ë¡œê·¸ì¸í•˜ê³  ëª¨ë“  ê¸°ëŠ¥ì„ ì´ìš©í•´ ë³´ì„¸ìš”</span>
                            </div>
                        `;
                        
                        section.appendChild(overlay);
                        
                        // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸
                        console.log('Restaurant overlay added to existing section:', section);
                    }
                });
            }
        }

        // AI ê¸°ëŠ¥ ëª¨ë‹¬ ì œì–´
        function initializeAIModal() {
            const aiFeatureBtn = document.getElementById("footerNavAI");
            const aiFeatureModal = document.getElementById("aiFeatureModal");
            
            if (aiFeatureBtn && aiFeatureModal) {
                // AI ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                aiFeatureBtn.addEventListener("click", function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('AI ë²„íŠ¼ í´ë¦­ë¨'); // ë””ë²„ê¹…ìš©
                    aiFeatureModal.classList.toggle("active");
                });
                
                // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
                document.addEventListener("click", function(e) {
                    if (aiFeatureModal.classList.contains("active") && 
                        !aiFeatureModal.contains(e.target) && 
                        !aiFeatureBtn.contains(e.target)) {
                        aiFeatureModal.classList.remove("active");
                    }
                });
                
                // ëª¨ë‹¬ ë‚´ë¶€ ë§í¬ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
                aiFeatureModal.addEventListener("click", function(e) {
                    if (e.target.tagName === "A") {
                        aiFeatureModal.classList.remove("active");
                    }
                });
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹ë‹¹ ì¶”ì²œ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ë¡œê·¸ì¸ ì œí•œ ì ìš©
            applyLoginRestrictions();
            
            // AI ëª¨ë‹¬ ì´ˆê¸°í™”
            initializeAIModal();
            
            // ì¹´ì¹´ì˜¤ë§µ API ë¡œë”© ìƒíƒœ í™•ì¸ í›„ ì´ˆê¸°í™”
            function initializeWhenReady() {
                if (typeof kakao !== 'undefined' && typeof kakao.maps !== 'undefined') {
                    window.restaurantRecommendation = new RestaurantRecommendation();
                } else {
                    // APIê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš° 1ì´ˆ í›„ ë‹¤ì‹œ ì‹œë„
                    setTimeout(initializeWhenReady, 1000);
                }
            }
            
            // ì´ˆê¸°í™” ì‹œì‘
            initializeWhenReady();
        });
    </script>

    <!-- ëª¨ë°”ì¼ í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="footer-nav-mobile">
      <ul>
        <li class="footer-nav-item" id="footerNavHome">
          <a href="index.html">
            <span class="footer-nav-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9,22 9,12 15,12 15,22"></polyline>
              </svg>
            </span>
            <span class="footer-nav-label">í™ˆ</span>
          </a>
        </li>
        <li class="footer-nav-item" id="footerNavNutrition">
          <a href="nutrition-info.html">
            <span class="footer-nav-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14,2 14,8 20,8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10,9 9,9 8,9"></polyline>
              </svg>
            </span>
            <span class="footer-nav-label">ì˜ì–‘ì •ë³´</span>
          </a>
        </li>
        <li class="footer-nav-item" id="footerNavAI">
          <button type="button" class="footer-nav-ai-btn">
            <span class="footer-nav-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4"></path>
                <path d="M21 12c-1 0-2-1-2-2s1-2 2-2 2 1 2 2-1 2-2 2z"></path>
                <path d="M3 12c1 0 2-1 2-2s-1-2-2-2-2 1-2 2 1 2 2 2z"></path>
                <path d="M12 3c0 1-1 2-2 2s-2-1-2-2 1-2 2-2 2 1 2 2z"></path>
                <path d="M12 21c0-1 1-2 2-2s2 1 2 2-1 2-2 2-2-1-2-2z"></path>
              </svg>
            </span>
            <span class="footer-nav-label">AIê¸°ëŠ¥</span>
          </button>
        </li>
        <li class="footer-nav-item" id="footerNavStore">
          <a href="store.html">
            <span class="footer-nav-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
              </svg>
            </span>
            <span class="footer-nav-label">ìŠ¤í† ì–´</span>
          </a>
        </li>
        <li class="footer-nav-item" id="footerNavMy">
          <a href="mypage.html">
            <span class="footer-nav-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </span>
            <span class="footer-nav-label">ë§ˆì´</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- AI ê¸°ëŠ¥ ëª¨ë‹¬ -->
    <div id="aiFeatureModal" class="ai-feature-modal">
      <div class="ai-feature-modal-content">
        <ul>
          <li><a href="meal-plan.html">ë­í•´ë¨¹ì§€?</a></li>
          <li><a href="supplements.html">ë‚˜ë§Œì˜ ì˜ì–‘ì œ</a></li>
          <li><a href="restaurant-recommendation.html">ì˜¤ëŠ˜ì˜ ë§›ì§‘</a></li>
        </ul>
      </div>
    </div>
</body>
</html> 